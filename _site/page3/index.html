<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Kiddinglife</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="icon" href="/favicon.ico?" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_8v3czwksspqlg14i.css">
    <link rel="stylesheet" href="/css/main.css ">
    <link rel="canonical" href="http://localhost:1234/page3/">
    <link rel="alternate" type="application/rss+xml" title="Kiddinglife" href="http://localhost:1234/feed.xml ">


    <script>
    // 百度统计代码
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?cf8506e0ef223e57ff6239944e5d46a4";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>


    <script>
    // google analytics
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-72449510-4', 'auto');
      ga('send', 'pageview');

    </script>

</head>


  <body>

    <header id="top">
    <div class="wrapper">
        <a href="/" class="brand">Kiddinglife</a>
        <small>C/C++/PYTHON ENGINEER</small>
        <button id="headerMenu" class="menu"><i class="fa fa-bars"></i></button>
        <nav id="headerNav">
            <ul>
                <li>
                    
                    <a href="/">
                    
                        <i class="fa fa-home"></i>Home
                    </a>
                </li>

                
                    
                    <li>
                        
                        <a href="/archive/">
                        
                            <i class="fa fa-archive"></i>Archives
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/category/">
                        
                            <i class="fa fa-th-list"></i>Categories
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/tag/">
                        
                            <i class="fa fa-tags"></i>Tags
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/collection/">
                        
                            <i class="fa fa-bookmark"></i>Collections
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/demo/">
                        
                            <i class="fa fa-play"></i>Demo
                        </a>
                    </li>
                    
                
                    
                    <li>
                        
                        <a href="/about/">
                        
                            <i class="fa fa-heart"></i>About
                        </a>
                    </li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        </nav>
    </div>
</header>


        <div class="page clearfix" index>
    <div class="left">
        <h1>For My Youth Dedicated to Programming</h1>
        <small>this blog is used to refine my knowledges about IT</small>
        <hr>
        <ul>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/03/23/good-logging-practice/">Good Logging Practices</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-03-23
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#logging" title="Category: logging" rel="category">logging</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#debug" title="Tag: debug" rel="tag">debug</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#1-good-or-bad-logging" id="markdown-toc-1-good-or-bad-logging">1 Good or Bad Logging</a></li>
  <li><a href="#2-never-log-too-much" id="markdown-toc-2-never-log-too-much">2 Never log too much</a></li>
  <li><a href="#3-never-log-too-little" id="markdown-toc-3-never-log-too-little">3 Never log too little</a></li>
  <li><a href="#4-good-things-to-log" id="markdown-toc-4-good-things-to-log">4 Good things to log</a></li>
  <li><a href="#5-bad-things-to-log" id="markdown-toc-5-bad-things-to-log">5 Bad things to log</a></li>
  <li><a href="#6-more-than-one-logging-level" id="markdown-toc-6-more-than-one-logging-level">6 More Than One Logging Level</a></li>
  <li><a href="#7-more-than-one-logging-category" id="markdown-toc-7-more-than-one-logging-category">7 More Than One Logging Category</a></li>
  <li><a href="#8-use-unique-identifiers" id="markdown-toc-8-use-unique-identifiers">8 Use Unique Identifiers</a></li>
  <li><a href="#9-log-timing-infos" id="markdown-toc-9-log-timing-infos">9 Log Timing Infos</a></li>
  <li><a href="#10-use-log-queue" id="markdown-toc-10-use-log-queue">10 Use Log Queue</a></li>
  <li><a href="#11-always-improve-logging" id="markdown-toc-11-always-improve-logging">11 Always Improve Logging</a></li>
</ul>

<h4 id="1-good-or-bad-logging">1 Good or Bad Logging</h4>
<p>How long does it take to find the root cause of a failure in your system?</p>
<ul>
  <li>tens of minutes
    <ul>
      <li>it’s very likely that your production system and tests have great logging</li>
    </ul>
  </li>
  <li>tens of hours
    <ul>
      <li>it’s very likely that your production system and tests have poor logging</li>
    </ul>
  </li>
</ul>

<h4 id="2-never-log-too-much">2 Never log too much</h4>
<p>If you log too much, you’ll need to:</p>
<ul>
  <li>devise complex approaches to minimize disk access,</li>
  <li>maintain log history, archive large quantities of data,</li>
  <li>query these large sets of data.</li>
  <li>make it very difficult to find valuable information.</li>
</ul>

<h4 id="3-never-log-too-little">3 Never log too little</h4>
<p>normally two main goals of logging:</p>
<ul>
  <li>help with bug investigation</li>
  <li>and event confirmation.</li>
</ul>

<p>If your log can’t explain the cause of a bug or whether a certain transaction took place,<br />
you are logging too little.</p>

<h4 id="4-good-things-to-log">4 Good things to log</h4>
<ul>
  <li>Important startup configuration</li>
  <li>Errors</li>
  <li>Warnings</li>
  <li>Changes to persistent data</li>
  <li>Requests and responses between major system components</li>
  <li>Significant state changes</li>
  <li>User interactions</li>
  <li>Calls with a known risk of failure</li>
  <li>Waits on conditions that could take measurable time to satisfy</li>
  <li>Periodic progress during long-running tasks</li>
  <li>Significant branch points of logic and conditions that led to the branch</li>
  <li>Summaries of processing steps or events from high level functions.<br />
Avoid logging every step of a complex process in low-level functions.</li>
</ul>

<h4 id="5-bad-things-to-log">5 Bad things to log</h4>
<ul>
  <li>Function entry.
    <ul>
      <li>Don’t log a function entry unless it is significant or logged at the debug level.</li>
    </ul>
  </li>
  <li>Data within a loop.
    <ul>
      <li>Avoid logging from many iterations of a loop.</li>
      <li>It is OK to log from iterations of small loops or to log periodically from large loops.</li>
    </ul>
  </li>
  <li>Content of large messages or files.
    <ul>
      <li>Truncate or summarize the data in some way that will be useful to debugging.</li>
    </ul>
  </li>
  <li>Benign errors.
    <ul>
      <li>Errors that are not really errors can confuse the log reader.</li>
      <li>This sometimes happens when exception handling is part of successful execution flow.</li>
    </ul>
  </li>
  <li>Repetitive errors.
    <ul>
      <li>Do not repetitively log the same or similar error.</li>
      <li>This can quickly fill a log and hide the actual cause.</li>
      <li>Frequency of error types is best handled by monitoring.</li>
      <li>Logs only need to capture detail for some of those errors.</li>
    </ul>
  </li>
  <li>Useless infos.</li>
</ul>

<h4 id="6-more-than-one-logging-level">6 More Than One Logging Level</h4>
<ul>
  <li>You can enable certain levels at system startup, which provides a convenient control for log verbosity.</li>
  <li>Practically speaking, only two log configurations are needed:
    <ul>
      <li>Production
        <ul>
          <li>Every level is enabled except debug.</li>
          <li>If something goes wrong in production, the logs should reveal the cause.</li>
        </ul>
      </li>
      <li>Development &amp; Debug
        <ul>
          <li>While developing new code or trying to reproduce a production issue, enable all levels.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>The classic levels are:
    <ul>
      <li>Debug
        <ul>
          <li>verbose and only useful while developing and/or debugging.</li>
        </ul>
      </li>
      <li>Info
        <ul>
          <li>the most popular level.</li>
          <li>should be helpful to locate warn,error and critical msg.</li>
          <li>usually should be &lt;= 10% of debug or trace logs.</li>
          <li>eg. subsystem initializations or a request succeeds.</li>
        </ul>
      </li>
      <li>Warning
        <ul>
          <li>strange or unexpected states that are acceptable.</li>
          <li>but if not solved, it may become normal or critical error</li>
          <li>eg. disk usage exceeding throuds.</li>
        </ul>
      </li>
      <li>Error
        <ul>
          <li>something went wrong, but the process can recover.</li>
        </ul>
      </li>
      <li>Critical
        <ul>
          <li>the process cannot recover, and it will shutdown or restart.</li>
          <li>Usually, the process logs only one critical msg once shutdown or restart.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>critical and error msgs are generated when application itself goes wrong<br />
and problems need to be fixed by external forces like developer or system admin.</p>

<p>the process actually died if critical msg happens while the process is still alive<br />
but cannot provide service if error msg happens.</p>

<h4 id="7-more-than-one-logging-category">7 More Than One Logging Category</h4>
<p>The classic categories are (based on functionality):</p>
<ul>
  <li>Diagnostic log
    <ul>
      <li>network request entry and exit</li>
      <li>external service invocation and return</li>
      <li>resource operation: open file handler</li>
      <li>error-tolerant operation</li>
      <li>program error: fail to connect to db</li>
      <li>background operation: resource clean up</li>
      <li>startup and close process and load configures</li>
      <li>do not log when exception thrown</li>
    </ul>
  </li>
  <li>Statistical log
    <ul>
      <li>user visits</li>
      <li>billing log</li>
      <li>resource log: network or disk usage</li>
    </ul>
  </li>
  <li>Monitoring log
    <ul>
      <li>administration operation</li>
    </ul>
  </li>
</ul>

<p>Statistical log and Diagnostic log complement each other</p>
<ul>
  <li>Statistical log shows the symptoms of problems and Diagnostic</li>
  <li>log shows details and state on individual transactions.</li>
</ul>

<p>For each log type above (request entry and exit and so on),<br />
they should:</p>
<ul>
  <li>write into different log files</li>
  <li>log different msgs with different formats</li>
</ul>

<h4 id="8-use-unique-identifiers">8 Use Unique Identifiers</h4>
<p>create unique identifiers for transactions that involve processing across<br />
many threads and/or processes to  makes it much easier to trace a specific<br />
transaction when many transactions are being processed concurrently.</p>
<ol>
  <li>initiator of the transaction should create the ID</li>
  <li>initiator passes id to every component that performs work for the transaction</li>
  <li>the id is logged by each component when logging information about the transaction</li>
</ol>

<h4 id="9-log-timing-infos">9 Log Timing Infos</h4>
<p>Logged timing data can help debug performance issues</p>
<ul>
  <li>eg. determine the cause of a timeout in a large system</li>
</ul>

<p>Logging the start and finish times of calls that can take measurable time:</p>
<ul>
  <li>Significant system calls</li>
  <li>Network requests</li>
  <li>CPU intensive operations</li>
  <li>Connected device interactions</li>
  <li>Transactions</li>
</ul>

<h4 id="10-use-log-queue">10 Use Log Queue</h4>
<ul>
  <li>When errors occur, the log should contain a lot of detail.</li>
  <li>Unfortunately, detail that led to an error is often unavailable once the error is encountered</li>
  <li>A good way to solve this problem is to create temporary, in-memory log queues.
    <ol>
      <li>Throughout processing of a transaction, append verbose details about each step to the queue.</li>
      <li>If the transaction completes successfully, discard the queue and log a summary.</li>
      <li>If an error is encountered, log the content of the entire queue and the error.</li>
    </ol>
  </li>
  <li>This technique is especially useful for test logging of system interactions.</li>
  <li><a href="https://github.com/egymgmbh/log-queue">An open-source implementation of log queue from GitHub</a></li>
</ul>

<h4 id="11-always-improve-logging">11 Always Improve Logging</h4>
<p>When problems occur, before fixing the problem:</p>
<ul>
  <li>fix your logging so that the logs clearly show the cause.
    <ul>
      <li>in development env
        <ul>
          <li>while writing new code, try to refrain from using <br />
debuggers and only use the logs.</li>
          <li>Do the logs describe what is going on? If not,the logging is insufficient.</li>
        </ul>
      </li>
      <li>in production env
        <ul>
          <li>if you cannot reproduce the problem, or you have a flaky test, <br />
enhance the logs so that the problem can be tracked down when it happens again.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>If this problem ever happens again, it’ll be much easier to identify.</li>
</ul>


                </div>
                <div class="read-all">
                    <a  href="/2016/03/23/good-logging-practice/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/03/22/swig-4-wrap-cplusplus/">SWIG-4: Wrap C++</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-03-22
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tool" title="Category: tool" rel="category">tool</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#swig" title="Tag: swig" rel="tag">swig</a>&nbsp;
    
        <a href="/tag/#script-language" title="Tag: script-language" rel="tag">script-language</a>&nbsp;
    
        <a href="/tag/#c/c++" title="Tag: c/c++" rel="tag">c/c++</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#61-introduction-of-c-wrapping" id="markdown-toc-61-introduction-of-c-wrapping">6.1 Introduction of C++ Wrapping</a></li>
  <li><a href="#62-approach-of-c-wrapping" id="markdown-toc-62-approach-of-c-wrapping">6.2 Approach of C++ Wrapping</a></li>
  <li><a href="#63-supported-c-features" id="markdown-toc-63-supported-c-features">6.3 Supported C++ features</a></li>
  <li><a href="#64-command-line-options-and-compilation" id="markdown-toc-64-command-line-options-and-compilation">6.4 Command line options and compilation</a></li>
  <li><a href="#65-proxy-classes" id="markdown-toc-65-proxy-classes">6.5 Proxy classes</a>    <ul>
      <li><a href="#651-construction-of-proxy-classes" id="markdown-toc-651-construction-of-proxy-classes">6.5.1 Construction of proxy classes</a></li>
      <li><a href="#652-resource-management-in-proxies" id="markdown-toc-652-resource-management-in-proxies">6.5.2 Resource management in proxies</a></li>
      <li><a href="#6521-issues-brought-from-proxies" id="markdown-toc-6521-issues-brought-from-proxies">6.5.2.1 Issues brought from proxies</a></li>
      <li><a href="#6521-solution-is-ownership-transfer" id="markdown-toc-6521-solution-is-ownership-transfer">6.5.2.1 Solution is ownership transfer</a></li>
    </ul>
  </li>
  <li><a href="#66-simple-c-wrapping" id="markdown-toc-66-simple-c-wrapping">6.6 Simple C++ wrapping</a>    <ul>
      <li><a href="#661-c-style-constructors-and-destructors" id="markdown-toc-661-c-style-constructors-and-destructors">6.6.1 C-style Constructors and destructors</a></li>
    </ul>
  </li>
  <li><a href="#662-default-ctors-copy-ctors-and-implicit-dtors" id="markdown-toc-662-default-ctors-copy-ctors-and-implicit-dtors">6.6.2 Default ctors, copy ctors and implicit dtors</a></li>
</ul>

<p>This chapter describes SWIG’s support for wrapping C++. As a prerequisite, 
you should first read the chapter <em>SWIG-3: Wrap ANSI C Type</em> to see how SWIG wraps ANSI C. 
Support for C++ builds upon ANSI C wrapping and that material will be useful 
in understanding this chapter.</p>

<h2 id="61-introduction-of-c-wrapping">6.1 Introduction of C++ Wrapping</h2>
<p>SWIG only provides support for a subset of C++ features. Fortunately, this is now a rather large subset.
there is no semantically obvious (or automatic ) way to map many of its advanced features into other 
languages. As a simple example:</p>
<ul>
  <li>consider the problem of wrapping C++ multiple inheritance to a target language with no such support.</li>
  <li>Similarly, the use of overloaded operators and overloaded functions can be problematic when no such 
 capability exists in a target language.</li>
</ul>

<p>In contrast, C++ has increasingly relied upon generic programming and templates for much of its 
functionality. Although templates are a powerful feature, they are largely orthogonal to the whole notion 
of binary components and libraries. For example, an STL vector does not define any kind of binary object 
for which SWIG can just create a wrapper.</p>

<h2 id="62-approach-of-c-wrapping">6.2 Approach of C++ Wrapping</h2>
<p>To wrap C++, SWIG uses a layered approach to code generation.</p>

<p><em>At the lowest level,</em> SWIG generates a collection of procedural ANSI-C style wrappers. These wrappers take 
care of basic type conversion, type checking, error handling, and other low-level details of the C++ binding.</p>

<p>These wrappers are also sufficient to bind C++ into any target language that supports built-in procedures. 
In some sense, you might view this layer of wrapping as providing a C library interface to C++.</p>

<p><em>On top of the low-level procedural (flattened) interface,</em> SWIG generates <em>proxy classes</em> that provide a natural 
object-oriented (OO) interface to the underlying code. The proxy classes are typically written in the target language 
itself. For instance, in Python, a real Python class is used to provide a wrapper around the underlying C++ object.</p>

<p>SWIG tries to maintain a very strict and clean separation between the implementation of your C++ application 
and the resulting wrapper code.it does not play sneaky tricks with the C++ type system, it doesn’t mess with your class 
hierarchies, and it doesn’t introduce new semantics.</p>

<p><strong>NOTE:</strong> <em>Although this approach might not provide the most seamless integration with C++ (not most efficiently), 
it is safe, simple, portable, and debuggable.</em></p>

<p>Some of this chapter focuses on the low-level procedural interface to C++ that is used as the foundation for 
all language modules.</p>

<p><strong>NOTE:</strong> Keep in mind that the target languages also provide the high-level OO interface via proxy classes. 
More detailed coverage can be found in the documentation for each target language.</p>

<h2 id="63-supported-c-features">6.3 Supported C++ features</h2>
<p>SWIG currently supports most C++ features including the following:</p>
<ul>
  <li>Classes</li>
  <li>Constructors and destructors</li>
  <li>Virtual functions</li>
  <li>Public inheritance (including multiple inheritance)</li>
  <li>Static functions</li>
  <li>Function and method overloading</li>
  <li>Operator overloading for many standard operators</li>
  <li>References</li>
  <li>Templates (including specialization and member templates)</li>
  <li>Pointers to members</li>
  <li>Namespaces</li>
  <li>Default parameters</li>
  <li>Smart pointers</li>
</ul>

<p>The following C++ features are not currently supported:</p>
<ul>
  <li>Overloaded versions of certain operators (new, delete, etc.)</li>
</ul>

<p><strong>NOTE:</strong> As a rule of thumb, SWIG should not be used on raw C++ source files, <em>use header files only.</em></p>

<h2 id="64-command-line-options-and-compilation">6.4 Command line options and compilation</h2>
<p>When wrapping C++ code, it is critical that SWIG be called with the <code class="highlighter-rouge">-c++</code> option.</p>

<p>When compiling and linking the resulting wrapper file, it is normal to use the <code class="highlighter-rouge">C++</code> compiler. For example:</p>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>swig -c++ -tcl example.i
<span class="gp">$ </span>c++ -fPIC -c example_wrap.cxx 
<span class="gp">$ </span>c++ example_wrap.o <span class="k">$(</span>OBJS<span class="k">)</span> -o example.so
</code></pre>
</div>
<p>Unfortunately, the process varies slightly on each platform. Make sure you refer to the documentation on each 
target language for further details.</p>

<h2 id="65-proxy-classes">6.5 Proxy classes</h2>
<p>if you’re building a Python module, each C++ class is wrapped by a Python proxy class.<br />
Or if you’re building a Java module, each C++ class is wrapped by a Java proxy class.</p>

<h3 id="651-construction-of-proxy-classes">6.5.1 Construction of proxy classes</h3>
<p>roxy classes are always constructed as an extra layer of wrapping that uses low-level accessor functions. 
To illustrate, suppose you had a C++ class like this:</p>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code>class Foo <span class="o">{</span>
  public:
    Foo<span class="o">()</span>;
    ~Foo<span class="o">()</span>;
    int  bar<span class="o">(</span>int x<span class="o">)</span>;
    int  x;
<span class="o">}</span>;
</code></pre>
</div>
<p>the real proxy class is written in the target language. For example, in Python, 
the proxy might look roughly like this:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">this</span> <span class="o">=</span> <span class="n">new_Foo</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">delete_Foo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">this</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Foo_bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">this</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'x'</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Foo_x_get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">this</span><span class="p">)</span>
        <span class="c"># ...</span>
    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'x'</span><span class="p">:</span>
            <span class="n">Foo_x_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">this</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c"># ...</span>
</code></pre>
</div>
<p><strong>NOTE:</strong> the low-level accessor functions are always used by the proxy classes. 
Whenever possible, proxies try to take advantage of language features that 
are similar to C++. This might include operator overloading, exception handling, 
and other features.</p>

<h3 id="652-resource-management-in-proxies">6.5.2 Resource management in proxies</h3>
<h3 id="6521-issues-brought-from-proxies">6.5.2.1 Issues brought from proxies</h3>
<p>A major issue with proxies concerns the memory management of wrapped 
objects. Consider the following C++ code:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Foo</span> 
<span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="n">Foo</span><span class="p">();</span>
        <span class="o">~</span><span class="n">Foo</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">bar</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Spam</span> 
<span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="n">Foo</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
        <span class="p">...</span>
<span class="p">};</span>
</code></pre>
</div>
<p>Consider some script code that uses these classes:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>               <span class="c"># Creates a new Foo 1</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Spam</span><span class="p">()</span>           <span class="c"># Creates a new Spam 1</span>
<span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">f</span>            <span class="c"># Stores a reference to f inside s 2</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span>           <span class="c"># Returns stored reference 3</span>
<span class="n">g</span> <span class="o">=</span> <span class="mi">4</span>                    <span class="c"># Reassign g to some other value 4</span>
<span class="k">del</span> <span class="n">f</span>                     <span class="c"># Destroy f 5</span>
</code></pre>
</div>
<p>1.When objects are created in the script, the objects are wrapped by newly 
created proxy classes. That is, there is both a new proxy class instance and 
a new instance of the underlying C++ class.In this example, both <code class="highlighter-rouge">f</code> and <code class="highlighter-rouge">s</code> 
are created in this way.</p>

<p>2.However, the statement s.value is rather curious. <code class="highlighter-rouge">s.value</code> is a script 
representations of <code class="highlighter-rouge">Foo*</code>. when executed, a pointer to f is set to Foo* value inside<br />
the underlying C++ object of <code class="highlighter-rouge">s</code> . This means that the scripting proxy class 
AND another C++ class share a reference to the same object. As a result,
now the underlying C++ object of <code class="highlighter-rouge">s</code> stores a reference to the underlying 
C++ object of <code class="highlighter-rouge">f</code>.</p>

<p>3.To make matters even more interesting, consider the statement <code class="highlighter-rouge">g = s.value</code>. 
When executed, this creates a new proxy class g that provides a wrapper 
around the C++ object stored in <code class="highlighter-rouge">s.value</code>.</p>

<p>In general, there is no way to know where this object came from—it could 
have been created by the script, but it could also have been generated internally.</p>

<p>In this particular example, the assignment of g results in a second proxy 
class for <code class="highlighter-rouge">Foo</code>. In other words, a reference to <code class="highlighter-rouge">Foo</code> is now shared by two proxy 
objects (<code class="highlighter-rouge">f</code> and <code class="highlighter-rouge">g</code>) and a C++ object(<code class="highlighter-rouge">Spam</code>).</p>

<p>4.In the statement, g=4, the variable g is reassigned. In many languages, 
this makes the old value of g available for garbage collection. Therefore, 
this causes one of the proxy classes to be destroyed.</p>

<p>5.Later on, the statement del f destroys the other proxy class.</p>

<p><em>Of course, there is still a reference to the original object stored inside another C++ 
object. What happens to it? Is the object still valid?</em></p>

<h3 id="6521-solution-is-ownership-transfer">6.5.2.1 Solution is ownership transfer</h3>
<p>To answer this problem, we must talk anout proxy classes that provide an API
for controlling ownership. In C++ pseudocode, ownership control might 
look roughly like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FooProxy</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="n">Foo</span>    <span class="o">*</span><span class="n">self</span><span class="p">;</span>
    <span class="kt">int</span>     <span class="n">thisown</span><span class="p">;</span>

    <span class="n">FooProxy</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">self</span> <span class="o">=</span> <span class="n">new_Foo</span><span class="p">();</span>
      <span class="n">thisown</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>       <span class="c1">// Newly created object
</span>    <span class="p">}</span>
    <span class="o">~</span><span class="n">FooProxy</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">thisown</span><span class="p">)</span> <span class="n">delete_Foo</span><span class="p">(</span><span class="n">self</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="p">...</span>
    <span class="c1">// Ownership control API
</span>    <span class="kt">void</span> <span class="n">disown</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">thisown</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">acquire</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">thisown</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">FooPtrProxy</span><span class="o">:</span> <span class="k">public</span> <span class="n">FooProxy</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">FooPtrProxy</span><span class="p">(</span><span class="n">Foo</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
    <span class="n">thisown</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">SpamProxy</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">FooProxy</span> <span class="o">*</span><span class="n">value_get</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">FooPtrProxy</span><span class="p">(</span><span class="n">Spam_value_get</span><span class="p">(</span><span class="n">self</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="n">value_set</span><span class="p">(</span><span class="n">FooProxy</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Spam_value_set</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">self</span><span class="p">);</span>
    <span class="n">v</span><span class="o">-&gt;</span><span class="n">disown</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">};</span>
</code></pre>
</div>
<p>Looking at this code, there are a few central features:</p>
<ol>
  <li>Each proxy class keeps an extra flag to indicate ownership. C++ objects 
 are only destroyed if the ownership flag is set.</li>
  <li>When new objects are created in the target language, the ownership 
 flag is set.</li>
  <li>When a reference to an internal C++ object is returned, it is wrapped
  by a proxy class, but the proxy class does not have ownership.</li>
  <li>In certain cases, ownership is adjusted. For instance, when a value is 
 assigned to the member of a class, ownership is lost.</li>
  <li>Manual ownership control is provided by special disown() and acquire() 
 methods.</li>
</ol>

<p>Given the tricky nature of C++ memory management, it is impossible for 
proxy classes to automatically handle every possible memory management 
problem. However, proxies do provide a mechanism for manual control 
that can be used (if necessary) to address some of the more tricky memory 
management problems.</p>

<p><strong>NOTE:</strong> Language specific details on proxy classes are contained in the chapters 
describing each target language. This chapter has merely introduced the 
topic in a very general way.</p>

<h2 id="66-simple-c-wrapping">6.6 Simple C++ wrapping</h2>
<p>The following code shows a SWIG interface file for a simple C++ class:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">module</span> <span class="n">list</span>
<span class="o">%</span><span class="p">{</span>
        <span class="cp">#include "list.h"
</span><span class="o">%</span><span class="p">}</span>

<span class="c1">// Very simple C++ example for linked list
</span><span class="k">class</span> <span class="nc">List</span> 
<span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
        <span class="n">List</span><span class="p">();</span>
        <span class="o">~</span><span class="n">List</span><span class="p">();</span>
        <span class="kt">int</span>  <span class="n">search</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
        <span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
        <span class="kt">void</span> <span class="n">remove</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
        <span class="kt">char</span> <span class="o">*</span><span class="n">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">List</span> <span class="o">*</span><span class="n">l</span><span class="p">);</span>
        
        <span class="kt">int</span>  <span class="n">length</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>
<p>To generate wrappers for this class, SWIG first reduces the class to a 
collection of <em>low-level C-style accessor functions</em> which are then used 
by the proxy classes.</p>

<h3 id="661-c-style-constructors-and-destructors">6.6.1 C-style Constructors and destructors</h3>
<p>C++ constructors and destructors are translated into accessor functions 
such as the following :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">List</span> <span class="o">*</span> <span class="nf">new_List</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">List</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">delete_List</span><span class="p">(</span><span class="n">List</span> <span class="o">*</span><span class="n">l</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">delete</span> <span class="n">l</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<h2 id="662-default-ctors-copy-ctors-and-implicit-dtors">6.6.2 Default ctors, copy ctors and implicit dtors</h2>
<p><em>Following the C++ rules for implicit constructor and destructors, 
SWIG will automatically assume there is one even when they are not 
explicitly declared in the class interface.</em></p>

<p>In general then:</p>
<ol>
  <li>If a C++ class does not declare any explicit constructor, 
SWIG will automatically generate a wrapper for one.</li>
  <li>If a C++ class does not declare an explicit copy constructor, 
SWIG will automatically generate a wrapper for one if the <code class="highlighter-rouge">%copyctor</code> is used.</li>
  <li>If a C++ class does not declare an explicit destructor, SWIG will 
automatically generate a wrapper for one.</li>
</ol>

<p><em>And as in C++, a few rules that alters the previous behavior:</em></p>
<ol>
  <li>A default constructor is not created if a class already defines 
 a constructor with arguments.</li>
  <li>Default constructors are not generated for classes with pure virtual 
 methods or for classes that inherit from an abstract class, but don’t 
 provide definitions for all of the pure methods.</li>
  <li>A default constructor is not created unless all base classes support a 
 default constructor.</li>
  <li>Default constructors and implicit destructors are not created if a class 
 defines them in a private or protected section.</li>
  <li>Default constructors and implicit destructors are not created if any 
 base class defines a non-public default constructor or destructor.</li>
</ol>

<p>To manually disable these, the <code class="highlighter-rouge">%nodefaultctor</code> and <code class="highlighter-rouge">%nodefaultdtor</code> feature
flag directives can be used.</p>

<p><strong>NOTE:</strong>  that these directives only affects the Implicit generation, 
and they have no effect if the default/copy constructors or destructor 
are explicitly declared in the class interface.</p>

<p>For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">nodefaultctor</span> <span class="n">Foo</span><span class="p">;</span>  <span class="c1">// Disable the default constructor for class Foo.
</span><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>          
<span class="c1">// No default constructor is generated, unless one is declared
</span><span class="p">...</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>         
 <span class="c1">// A default constructor is generated, if possible
</span><span class="p">...</span>
<span class="p">};</span>
</code></pre>
</div>
<p>The directive <code class="highlighter-rouge">%nodefaultctor</code> can also be applied “globally”, as in:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">nodefaultctor</span><span class="p">;</span> <span class="c1">// Disable creation of default constructors
</span><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>     
<span class="c1">// No default constructor is generated, unless one is declared
</span><span class="p">...</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>   
<span class="k">public</span><span class="o">:</span>
  <span class="n">Bar</span><span class="p">();</span>        
  <span class="c1">// The default constructor is generated, since one is declared
</span><span class="p">};</span>
<span class="o">%</span><span class="n">clearnodefaultctor</span><span class="p">;</span> <span class="c1">// Enable the creation of default constructors again
</span></code></pre>
</div>
<p>The corresponding <code class="highlighter-rouge">%nodefaultdtor</code> directive can be used to disable the 
generation of the default or implicit destructor:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">nodefaultdtor</span> <span class="n">Foo</span><span class="p">;</span>   <span class="c1">// Disable the implicit/default destructor for class Foo.
</span><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>           
<span class="c1">// No destructor is generated, unless one is declared
</span><span class="p">...</span>
<span class="p">};</span>
</code></pre>
</div>
<p><strong>Note:</strong> The <code class="highlighter-rouge">%nodefault</code> directive/ <code class="highlighter-rouge">-nodefault</code> options described above, 
which disable both the default constructor and the implicit destructors, 
could lead to memory leaks, and so it is strongly recommended to not use them.</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/03/22/swig-4-wrap-cplusplus/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/03/20/swig-2-scripting-lang/">SWIG-2: Script Lang</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-03-20
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tool" title="Category: tool" rel="category">tool</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#swig" title="Tag: swig" rel="tag">swig</a>&nbsp;
    
        <a href="/tag/#script-language" title="Tag: script-language" rel="tag">script-language</a>&nbsp;
    
        <a href="/tag/#c/c++" title="Tag: c/c++" rel="tag">c/c++</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#42-how-does-a-script-lang-talk-to-c" id="markdown-toc-42-how-does-a-script-lang-talk-to-c">4.2 How does a script lang talk to C?</a>    <ul>
      <li><a href="#421-wrapper-functions" id="markdown-toc-421-wrapper-functions">4.2.1 Wrapper functions</a></li>
      <li><a href="#422-variable-linking" id="markdown-toc-422-variable-linking">4.2.2 Variable linking</a></li>
      <li><a href="#423-constants" id="markdown-toc-423-constants">4.2.3 Constants</a></li>
      <li><a href="#424-structures-and-classes" id="markdown-toc-424-structures-and-classes">4.2.4 Structures and classes</a></li>
      <li><a href="#425-proxy-classes" id="markdown-toc-425-proxy-classes">4.2.5 Proxy classes</a></li>
    </ul>
  </li>
</ul>

<p>This blog provides a brief overview of:</p>
<ol>
  <li>script language extension programming</li>
  <li>mechanisms by which script lang interpreters access C and C++ code</li>
</ol>

<p>C/C++ can be used for maximal performance and complicated systems programming tasks.<br />
Scripting languages can be used for rapid prototyping, interactive debugging, scripting, 
and access to high-level data structures such associative arrays.</p>

<h2 id="42-how-does-a-script-lang-talk-to-c">4.2 How does a script lang talk to C?</h2>
<p>By extending the interpreter, it is usually possible to add new commands and variables.</p>

<p>To do this, most lang define a special API for adding new commands. Furthermore, a special foreign function interface 
defines how these new commands are supposed to hook into the interpreter.</p>

<p>Typically, when you add a new command to a scripting interpreter you need to do two things:</p>
<ul>
  <li>first you need to write a special “wrapper” function that serves as the glue between the 
interpreter and the underlying C function.</li>
  <li>Then you need to give the interpreter information about the wrapper by providing 
details about the name of the function, arguments, and so forth.</li>
</ul>

<h3 id="421-wrapper-functions">4.2.1 Wrapper functions</h3>
<p>Suppose you have an ordinary C function like this :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">fact</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">return</span> <span class="n">n</span><span class="o">*</span><span class="n">fact</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>A wrapper function for it must do three things :</p>
<ul>
  <li>Gather function arguments and make sure they are valid.</li>
  <li>Call the C function.</li>
  <li>Convert the return value into a form recognized by the scripting language.</li>
</ul>

<p>As an example, the Tcl wrapper function for the fact() function above example might look like the following :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">wrap_fact</span><span class="p">(</span><span class="n">ClientData</span> <span class="n">clientData</span><span class="p">,</span> 
              <span class="n">Tcl_Interp</span> <span class="o">*</span><span class="n">interp</span><span class="p">,</span>
              <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> 
              <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">arg0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="n">interp</span><span class="o">-&gt;</span><span class="n">result</span> <span class="o">=</span> <span class="s">"wrong # args"</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">TCL_ERROR</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">arg0</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">fact</span><span class="p">(</span><span class="n">arg0</span><span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">interp</span><span class="o">-&gt;</span><span class="n">result</span><span class="p">,</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">TCL_OK</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<hr />
<p>Once you have created a wrapper function, the final step is to tell the scripting language about the new function. 
This is usually done in an initialization function called by the language when the module is loaded.</p>

<p>For example, adding the above function to the Tcl interpreter requires code like the following :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">Wrap_Init</span><span class="p">(</span><span class="n">Tcl_Interp</span> <span class="o">*</span><span class="n">interp</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Tcl_CreateCommand</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> 
    <span class="s">"fact"</span><span class="p">,</span> <span class="n">wrap_fact</span><span class="p">,</span> 
    <span class="p">(</span><span class="n">ClientData</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">,</span>
    <span class="p">(</span><span class="n">Tcl_CmdDeleteProc</span> <span class="o">*</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">TCL_OK</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p>When executed, Tcl will now have a new command called “fact” that you can use like any other Tcl command.</p>

<p>Although the process of adding a new function to Tcl has been illustrated, the procedure is almost identical 
for Perl and Python. Both require special wrappers to be written and both need additional initialization code.
Only the specific details are different.</p>

<h3 id="422-variable-linking">4.2.2 Variable linking</h3>
<p>ariable linking refers to the problem of mapping a C/C++ global variable to a variable in the scripting language 
interpreter. For example, suppose you had the following variable: <code class="highlighter-rouge">double Foo = 3.5;</code></p>

<p>evaluating a variable such as $Foo might implicitly call the get function. Similarly, typing $Foo = 4 would call the 
underlying set function to change the value.</p>

<h3 id="423-constants">4.2.3 Constants</h3>
<p>In many cases, a C program or library may define a large collection of constants. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#define RED
</span><span class="mh">0xff0000</span>
<span class="cp">#define BLUE 0x0000ff
#define GREEN 0x00ff00
</span></code></pre>
</div>
<p>To make constants available, their values can be stored in scripting language variables such as $RED, $BLUE, and $GREEN.
Virtually all scripting languages provide C functions for creating variables so installing constants is usually a trivial 
exercise.</p>

<h3 id="424-structures-and-classes">4.2.4 Structures and classes</h3>
<p>The most straightforward technique for handling structures is to implement a collection of accessor functions that hide the underlying representation of a structure. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Vector</span> <span class="p">{</span>
  <span class="n">Vector</span><span class="p">();</span>
  <span class="o">~</span><span class="n">Vector</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>
<p>can be transformed into the following set of functions :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Vector</span> <span class="o">*</span><span class="n">new_Vector</span><span class="p">();</span>
<span class="kt">void</span> <span class="n">delete_Vector</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">Vector_x_get</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">Vector_y_get</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">Vector_z_get</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">Vector_x_set</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kt">double</span> <span class="n">x</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">Vector_y_set</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">Vector_z_set</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="kt">double</span> <span class="n">z</span><span class="p">);</span>
</code></pre>
</div>
<p>Now, from an interpreter these function might be used as follows:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span> <span class="n">set</span> <span class="n">v</span> <span class="p">[</span><span class="n">new_Vector</span><span class="p">]</span>
<span class="o">%</span> <span class="n">Vector_x_set</span> <span class="err">$</span><span class="n">v</span> <span class="mf">3.5</span>
<span class="o">%</span> <span class="n">Vector_y_get</span> <span class="err">$</span><span class="n">v</span>
<span class="o">%</span> <span class="n">delete_Vector</span> <span class="err">$</span><span class="n">v</span>
<span class="o">%</span> <span class="p">...</span>
</code></pre>
</div>
<p>Since accessor functions provide a mechanism for accessing the internals of an object, the interpreter does not need to know anything about the actual representation of a Vector.</p>

<h3 id="425-proxy-classes">4.2.5 Proxy classes</h3>
<p>In certain cases, it is possible to use the low-level accessor functions to create a proxy class, also known as a shadow class. For example, if you have the following C++ definition :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Vector</span> 
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Vector</span><span class="p">();</span>
  <span class="o">~</span><span class="n">Vector</span><span class="p">();</span>
  <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>
<p>proxy classing mechanism would allow you to access the structure in a more natural manner from the interpreter. For example, in Python, you might want to do this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">4</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">13</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">del</span> <span class="n">v</span>
</code></pre>
</div>
<p>In the following blogs, we will go to the details of proxy class. See you then!</p>

                </div>
                <div class="read-all">
                    <a  href="/2016/03/20/swig-2-scripting-lang/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/03/20/swig-3-wrap-c/">SWIG-3: Wrap ANSI C</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-03-20
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tool" title="Category: tool" rel="category">tool</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#swig" title="Tag: swig" rel="tag">swig</a>&nbsp;
    
        <a href="/tag/#script-language" title="Tag: script-language" rel="tag">script-language</a>&nbsp;
    
        <a href="/tag/#c/c++" title="Tag: c/c++" rel="tag">c/c++</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#52-wrapping-simple-c-declarations" id="markdown-toc-52-wrapping-simple-c-declarations">5.2 Wrapping Simple C Declarations</a>    <ul>
      <li><a href="#521-basic-type-handling" id="markdown-toc-521-basic-type-handling">5.2.1 Basic Type Handling</a>        <ul>
          <li><a href="#5211-integral" id="markdown-toc-5211-integral">5.2.1.1 Integral</a></li>
          <li><a href="#5212-float" id="markdown-toc-5212-float">5.2.1.2 Float</a></li>
          <li><a href="#5213-unicode" id="markdown-toc-5213-unicode">5.2.1.3 Unicode:</a></li>
        </ul>
      </li>
      <li><a href="#522-global-variables" id="markdown-toc-522-global-variables">5.2.2 Global Variables</a></li>
      <li><a href="#523-constants" id="markdown-toc-523-constants">5.2.3 Constants</a>        <ul>
          <li><a href="#5231-special-cases" id="markdown-toc-5231-special-cases">5.2.3.1 Special cases</a></li>
          <li><a href="#5232-a-brief-word-about-const" id="markdown-toc-5232-a-brief-word-about-const">5.2.3.2 A brief word about const</a></li>
        </ul>
      </li>
      <li><a href="#525-a-cautionary-tale-of-char-" id="markdown-toc-525-a-cautionary-tale-of-char-">5.2.5 A cautionary tale of char *</a></li>
    </ul>
  </li>
  <li><a href="#53-pointers-and-complex-objects" id="markdown-toc-53-pointers-and-complex-objects">5.3 Pointers and complex objects</a>    <ul>
      <li><a href="#531-simple-pointers" id="markdown-toc-531-simple-pointers">5.3.1 Simple pointers</a></li>
      <li><a href="#532-run-time-pointer-type-checking" id="markdown-toc-532-run-time-pointer-type-checking">5.3.2 Run time pointer type checking</a></li>
      <li><a href="#533-derived-types-structs-and-classes" id="markdown-toc-533-derived-types-structs-and-classes">5.3.3 Derived types, structs, and classes</a></li>
      <li><a href="#535-typedef" id="markdown-toc-535-typedef">5.3.5 Typedef</a></li>
      <li><a href="#541-passing-structures-by-value" id="markdown-toc-541-passing-structures-by-value">5.4.1 Passing structures by value</a></li>
      <li><a href="#542-return-by-value" id="markdown-toc-542-return-by-value">5.4.2 Return by value</a></li>
      <li><a href="#543-linking-to-global-structure-variables" id="markdown-toc-543-linking-to-global-structure-variables">5.4.3 Linking to global structure variables</a></li>
      <li><a href="#544-linking-to-char" id="markdown-toc-544-linking-to-char">5.4.4 Linking to char*</a></li>
      <li><a href="#544-linking-to-const-char" id="markdown-toc-544-linking-to-const-char">5.4.4 Linking to const char*</a></li>
      <li><a href="#545-arrays" id="markdown-toc-545-arrays">5.4.5 Arrays</a></li>
      <li><a href="#548-defaultoptional-arguments" id="markdown-toc-548-defaultoptional-arguments">5.4.8 Default/optional arguments</a></li>
      <li><a href="#549-pointers-to-functions-and-callbacks" id="markdown-toc-549-pointers-to-functions-and-callbacks">5.4.9 Pointers to functions and callbacks</a></li>
    </ul>
  </li>
  <li><a href="#55-structures-and-unions" id="markdown-toc-55-structures-and-unions">5.5 Structures and unions</a>    <ul>
      <li><a href="#552-char-strings-members" id="markdown-toc-552-char-strings-members">5.5.2 Char* strings members</a></li>
      <li><a href="#553-array-members" id="markdown-toc-553-array-members">5.5.3 Array members</a></li>
      <li><a href="#555-c-constructors-and-destructors" id="markdown-toc-555-c-constructors-and-destructors">5.5.5 C constructors and destructors</a></li>
      <li><a href="#556-adding-member-functions-to-c-structures" id="markdown-toc-556-adding-member-functions-to-c-structures">5.5.6 Adding member functions to C structures</a></li>
      <li><a href="#557-nested-structures" id="markdown-toc-557-nested-structures">5.5.7 Nested structures</a></li>
    </ul>
  </li>
  <li><a href="#56-code-insertion" id="markdown-toc-56-code-insertion">5.6 Code Insertion</a>    <ul>
      <li><a href="#561-the-output-of-swig" id="markdown-toc-561-the-output-of-swig">5.6.1 The output of SWIG</a></li>
      <li><a href="#562-code-insertion-blocks" id="markdown-toc-562-code-insertion-blocks">5.6.2 Code insertion blocks</a></li>
      <li><a href="#563-inlined-header-code-blocks" id="markdown-toc-563-inlined-header-code-blocks">5.6.3 Inlined header code blocks</a></li>
      <li><a href="#564-initialization-blocks" id="markdown-toc-564-initialization-blocks">5.6.4 Initialization blocks</a></li>
    </ul>
  </li>
  <li><a href="#57-interface-building-strategy" id="markdown-toc-57-interface-building-strategy">5.7 Interface Building Strategy</a>    <ul>
      <li><a href="#571-preparing-a-c-program-for-swig" id="markdown-toc-571-preparing-a-c-program-for-swig">5.7.1 Preparing a C program for SWIG</a></li>
      <li><a href="#572-swig-interface-file" id="markdown-toc-572-swig-interface-file">5.7.2 SWIG interface file</a></li>
      <li><a href="#573-why-use-separate-interface-files" id="markdown-toc-573-why-use-separate-interface-files">5.7.3 Why use separate interface files?</a></li>
      <li><a href="#574-getting-the-right-header-files" id="markdown-toc-574-getting-the-right-header-files">5.7.4 Getting the right header files</a></li>
      <li><a href="#575-what-to-do-with-main" id="markdown-toc-575-what-to-do-with-main">5.7.5 What to do with main()</a></li>
    </ul>
  </li>
</ul>

<h2 id="52-wrapping-simple-c-declarations">5.2 Wrapping Simple C Declarations</h2>
<p>For example, consider the following interface file:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">module</span> <span class="n">example</span>
<span class="o">%</span><span class="kr">inline</span> <span class="o">%</span><span class="p">{</span>
<span class="k">extern</span> <span class="kt">double</span> <span class="n">sin</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">strcmp</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">Foo</span><span class="p">;</span>
<span class="o">%</span><span class="p">}</span>
<span class="cp">#define STATUS 50
#define VERSION "1.1"
</span></code></pre>
</div>
<p>When SWIG creates an extension module, these declarations are accessible as scripting language functions, 
variables, and constants respectively. For example, in python:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">example</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="mf">5.2335956</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">example</span><span class="o">.</span><span class="n">strcmp</span><span class="p">(</span><span class="s">'Dave'</span><span class="p">,</span> <span class="s">'Mike'</span><span class="p">)</span>
<span class="o">-</span><span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">example</span><span class="o">.</span><span class="n">cvar</span><span class="o">.</span><span class="n">Foo</span>
<span class="mi">42</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">example</span><span class="o">.</span><span class="n">STATUS</span>
<span class="mi">50</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">example</span><span class="o">.</span><span class="n">VERSION</span>
<span class="mf">1.1</span>
</code></pre>
</div>
<p>Whenever possible, SWIG creates an interface that closely matches the underlying C/C++ code. 
However, due to subtle differences between languages, run-time environments, and semantics, it is not always possible to do so.</p>

<h3 id="521-basic-type-handling">5.2.1 Basic Type Handling</h3>
<p>In order to build an interface, SWIG has to convert C/C++ datatypes to equivalent types in the target language:</p>

<h4 id="5211-integral">5.2.1.1 Integral</h4>
<p>When an integral value is converted from C, a cast is used to convert it to the representation in the target language. 
Thus, a 16 bit short in C may be promoted to a 32 bit integer. When integers are converted in the other direction,
 the value is cast back into the original C type. If the value is too large to fit, <em>it is silently truncated.</em></p>

<p>bool data type is cast to and from an integer value of 0 and 1 unless the target language provides a special boolean type.</p>

<p>unsigned/signed char are special cases that are handled as small 8-bit integers. Normally, the char datatype is mapped as a one-character ASCII string.</p>

<p><em>As a rule of thumb, the int datatype and all variations of char and short datatypes are safe to use. 
For unsigned int and long data types, you will need to carefully check the correct operation of your program after it has been wrapped with SWIG.</em></p>

<h4 id="5212-float">5.2.1.2 Float</h4>
<p>SWIG recognizes the following floating point types : float and double. Floating point numbers are mapped to 
and from the natural representation of floats in the target language. This is almost always a C <em>double</em>.</p>

<h4 id="5213-unicode">5.2.1.3 Unicode:</h4>
<p>For those scripting languages that provide Unicode support, Unicode strings are often available in an 8-bit 
representation such as UTF-8 that can be mapped to the char * type (in which case the SWIG interface will probably work).</p>

<h3 id="522-global-variables">5.2.2 Global Variables</h3>
<p>Whenever possible, SWIG maps C/C++ global variables into scripting language variables.</p>

<p>Whenever the scripting language variable is used, the underlying C global variable is accessed。
However, the way to access global variables in different script langs are different.</p>

<p>Finally, if a global variable has been declared as const, it only supports read-only access.</p>

<p>For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">module</span> <span class="n">example</span>
<span class="kt">double</span> <span class="n">foo</span><span class="p">;</span>
</code></pre>
</div>
<p>results in a scripting language variable like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp"># Tcl
</span><span class="n">set</span> <span class="n">foo</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">]</span>                   <span class="p">;</span><span class="err">#</span> <span class="n">Set</span> <span class="n">foo</span> <span class="n">to</span> <span class="mf">3.5</span>
<span class="n">puts</span> <span class="err">$</span><span class="n">foo</span>                       <span class="p">;</span><span class="err">#</span> <span class="n">Print</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">foo</span>
<span class="cp"># Python
</span><span class="n">cvar</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mf">3.5</span>                  <span class="err">#</span> <span class="n">Set</span> <span class="n">foo</span> <span class="n">to</span> <span class="mf">3.5</span>
<span class="n">print</span> <span class="n">cvar</span><span class="p">.</span><span class="n">foo</span>                  <span class="err">#</span> <span class="n">Print</span> <span class="n">value</span> <span class="n">of</span> <span class="n">foo</span>
<span class="cp"># Perl
</span><span class="err">$</span><span class="n">foo</span> <span class="o">=</span> <span class="mf">3.5</span><span class="p">;</span>                     <span class="err">#</span> <span class="n">Set</span> <span class="n">foo</span> <span class="n">to</span> <span class="mf">3.5</span>
<span class="n">print</span> <span class="err">$</span><span class="n">foo</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>               <span class="err">#</span> <span class="n">Print</span> <span class="n">value</span> <span class="n">of</span> <span class="n">foo</span>
<span class="cp"># Ruby
</span><span class="n">Module</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mf">3.5</span>               <span class="err">#</span> <span class="n">Set</span> <span class="n">foo</span> <span class="n">to</span> <span class="mf">3.5</span>
<span class="n">print</span> <span class="n">Module</span><span class="p">.</span><span class="n">foo</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>         <span class="err">#</span> <span class="n">Print</span> <span class="n">value</span> <span class="n">of</span> <span class="n">foo</span>
</code></pre>
</div>

<h3 id="523-constants">5.2.3 Constants</h3>
<p>Constants can be created using #define, enumerations, or a special %constant directive. 
The following interface file shows a few valid constant declarations :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#define I_CONST       5               // An integer constant
#define PI            3.14159         // A Floating point constant
#define S_CONST       "hello world"   // A string constant
#define NEWLINE       '\n'            // Character constant
</span><span class="k">enum</span> <span class="n">boolean</span> <span class="p">{</span><span class="n">NO</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">YES</span><span class="o">=</span><span class="mi">1</span><span class="p">};</span>
<span class="k">enum</span> <span class="n">months</span> <span class="p">{</span><span class="n">JAN</span><span class="p">,</span> <span class="n">FEB</span><span class="p">,</span> <span class="n">MAR</span><span class="p">,</span> <span class="n">APR</span><span class="p">,</span> <span class="n">MAY</span><span class="p">,</span> <span class="n">JUN</span><span class="p">,</span> <span class="n">JUL</span><span class="p">,</span> <span class="n">AUG</span><span class="p">,</span>
             <span class="n">SEP</span><span class="p">,</span> <span class="n">OCT</span><span class="p">,</span> <span class="n">NOV</span><span class="p">,</span> <span class="n">DEC</span><span class="p">};</span>
<span class="o">%</span><span class="n">constant</span> <span class="kt">double</span> <span class="n">BLAH</span> <span class="o">=</span> <span class="mf">42.37</span><span class="p">;</span>
<span class="cp">#define PI_4 PI/4
#define FLAGS 0x04 | 0x08 | 0x40
</span></code></pre>
</div>

<h4 id="5231-special-cases">5.2.3.1 Special cases</h4>
<p>1.SWIG will not create constants for macros unless the value can be completely determined by the preprocessor.</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#define EXTERN extern
</span><span class="n">EXTERN</span> <span class="kt">void</span> <span class="n">foo</span><span class="p">();</span>
</code></pre>
</div>
<p>what would the value of a constant called EXTERN would be?</p>

<p>2.for the same conservative reasons even a constant with a simple cast will be ignored, such as</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#define F_CONST (double) 5 // A floating point constant with cast
</span></code></pre>
</div>

<p>3.For enumerations, it is critical that the original enum definition be included somewhere 
in the interface file (either in a header file or in the %{ %} block) because it needs the original 
enumeration declaration in order to get the correct enum values as assigned by the C compiler.</p>

<h4 id="5232-a-brief-word-about-const">5.2.3.2 A brief word about const</h4>
<p>Typically, %constant is only used when you want to add constants to the scripting language interface 
that are not defined in the original header file.</p>

<p>If the right-most const occurs after all other type modifiers (such as pointers), then the variable is const. 
Otherwise, it is not. Here are some examples of const declarations:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="n">a</span><span class="p">;</span>           <span class="c1">// A constant character
</span><span class="kt">char</span> <span class="k">const</span> <span class="n">b</span><span class="p">;</span>           <span class="c1">// A constant character (the same)
</span><span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">c</span><span class="p">;</span>          <span class="c1">// A constant pointer to a character
</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">d</span><span class="p">;</span>    <span class="c1">// A constant pointer to a constant character
</span></code></pre>
</div>
<p>Here is an example of a declaration that is not const:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">e</span><span class="p">;</span> 
</code></pre>
</div>
<p>In this case, the pointer e can change — it’s only the value being pointed to that is read-only.</p>

<h3 id="525-a-cautionary-tale-of-char-">5.2.5 A cautionary tale of char *</h3>
<p>When strings are passed from a scripting language to a C char *, the pointer usually points to 
string data stored inside the interpreter.</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">strcat</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">t</span><span class="p">)</span>
</code></pre>
</div>
<p>your application will perhaps crashes with a segmentation fault or other memory related problem. 
This is because s refers to some internal data in the target language—data that you should mot  be touching.</p>

<h2 id="53-pointers-and-complex-objects">5.3 Pointers and complex objects</h2>
<h3 id="531-simple-pointers">5.3.1 Simple pointers</h3>
<p>Pointers to primitive C data types such as:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span><span class="o">*</span> <span class="n">p_int</span><span class="p">;</span>
<span class="kt">double</span><span class="o">***</span> <span class="n">ppp_double</span><span class="p">;</span>
<span class="kt">char</span><span class="o">**</span> <span class="n">pp_char</span><span class="p">;</span>
<span class="n">Int</span><span class="o">*</span> <span class="n">null_ptr</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
</code></pre>
</div>
<p>are fully supported by SWIG.</p>

<p>Rather than trying to convert the data being pointed to into a scripting representation, 
SWIG simply encodes the pointer itself into a representation that contains the actual 
value of the pointer and a type-tag.</p>

<p>Thus, the SWIG representation of the above pointers (in Tcl), might look like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">_10081012_p_int</span>
<span class="n">_1008e124_ppp_double</span>
<span class="n">_f8ac_pp_char</span>
<span class="n">_NULL_p_int</span>
</code></pre>
</div>

<p>All pointers are treated as opaque objects by SWIG. Thus, a pointer may be returned by 
a function and passed around to other C functions as needed.
<em>(? here is something I feel unclear and need go over in the future.)</em></p>

<p>The scripting language representation of a pointer value should never be manipulated directly.<br />
eg. the numbers used may differ from the actual machine address (e.g., on little-endian machines, 
the digits may appear in reverse order)</p>

<h3 id="532-run-time-pointer-type-checking">5.3.2 Run time pointer type checking</h3>
<p>Although this has the potential to cause a crash, NULL pointers are also 
sometimes used as sentinel values or to denote a missing/empty value. 
<em>Therefore, SWIG leaves NULL pointer checking up to the application</em>.<br />
<em>(? here is something I feel unclear when I wrote this blog and need go 
over in the future.)</em></p>

<h3 id="533-derived-types-structs-and-classes">5.3.3 Derived types, structs, and classes</h3>
<p>For everything else (structs, classes, arrays, etc…) SWIG applies a very simple rule :</p>
<blockquote>
  <p><strong>Everything else is a pointer</strong></p>
</blockquote>

<p>Suppose you have an interface file like this :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">module</span> <span class="n">fileio</span>
<span class="kt">FILE</span> <span class="o">*</span><span class="n">fopen</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">fclose</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="n">fread</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">nobj</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="n">fwrite</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">nobj</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">malloc</span><span class="p">(</span><span class="kt">int</span> <span class="n">nbytes</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
</code></pre>
</div>
<p>In this file, SWIG doesn’t know what a FILE is, but since it’s used as a pointer, 
so it doesn’t really matter what it is. If you wrapped this module into Python, 
you can use the functions just like you expect :</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># Copy a file </span>
<span class="k">def</span> <span class="nf">filecopy</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
  <span class="n">f1</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span>
  <span class="n">f2</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span>
  <span class="nb">buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mi">8192</span><span class="p">)</span>
  <span class="n">nbytes</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="nb">buffer</span><span class="p">,</span> <span class="mi">8192</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">nbytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="nb">buffer</span><span class="p">,</span> <span class="mi">8192</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
          <span class="n">nbytes</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="nb">buffer</span><span class="p">,</span> <span class="mi">8192</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
  <span class="n">free</span><span class="p">(</span><span class="nb">buffer</span><span class="p">)</span>
</code></pre>
</div>
<p>In this case f1, f2, and buffer are all opaque objects containing C pointers. 
It doesn’t matter what value they contain–our program works just fine 
without this knowledge.</p>

<p>When SWIG encounters an undeclared data type, it automatically assumes 
that it is a structure or class.</p>

<h3 id="535-typedef">5.3.5 Typedef</h3>
<p>Like C, typedef can be used to define new type names in SWIG. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="kt">size_t</span><span class="p">;</span>
</code></pre>
</div>

<p>typedef definitions appearing in a SWIG interface are not propagated to the 
generated wrapper code.</p>

<p>Therefore, they either need to be defined in an 
included header file or placed in the declarations section like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="p">{</span>
 <span class="cm">/* Include in the generated wrapper file */</span>  
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="kt">size_t</span><span class="p">;</span> 
<span class="o">%</span><span class="p">}</span>  
<span class="cm">/* Tell SWIG about it */</span>  
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="kt">size_t</span><span class="p">;</span>  
</code></pre>
</div>
<p>or</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="kr">inline</span> <span class="o">%</span><span class="p">{</span> <span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="kt">size_t</span><span class="p">;</span> <span class="o">%</span><span class="p">}</span>
</code></pre>
</div>

<p>SWIG tracks typedef declarations and uses this information for run-time 
type checking.</p>

<p>For instance, if you use the above typedef and had the following function 
declaration:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">void</span> <span class="n">foo</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
</code></pre>
</div>
<p>The corresponding wrapper function will accept arguments of type 
unsigned int * or size_t *.</p>

<h3 id="541-passing-structures-by-value">5.4.1 Passing structures by value</h3>
<p>For example, consider the following function:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">double</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">Vector</span> <span class="n">a</span><span class="p">,</span> <span class="n">Vector</span> <span class="n">b</span><span class="p">);</span>
</code></pre>
</div>
<p>To deal with this, SWIG transforms the function to use pointers by creating 
a wrapper equivalent to the following:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">double</span> <span class="nf">wrap_dot_product</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">Vector</span> <span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="n">a</span><span class="p">;</span>
    <span class="n">Vector</span> <span class="n">y</span> <span class="o">=</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">dot_product</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p>In the target language, the dot_product() function now accepts pointers to 
Vectors instead of Vectors. For the most part, this transformation is 
transparent so you might not notice.</p>

<h3 id="542-return-by-value">5.4.2 Return by value</h3>
<p>For example, consider the following function:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Vector</span> <span class="n">cross_product</span><span class="p">(</span><span class="n">Vector</span> <span class="n">v1</span><span class="p">,</span> <span class="n">Vector</span> <span class="n">v2</span><span class="p">);</span>
</code></pre>
</div>
<p>This function wants to return Vector, but SWIG only really supports pointers. 
As a result, SWIG creates a wrapper like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Vector</span> <span class="o">*</span><span class="nf">wrap_cross_product</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">v2</span><span class="p">)</span> 
<span class="p">{</span>
        <span class="n">Vector</span> <span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="n">v1</span><span class="p">;</span>
        <span class="n">Vector</span> <span class="n">y</span> <span class="o">=</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span>
        <span class="n">Vector</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Vector</span><span class="p">));</span>
        <span class="o">*</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Or if SWIG was run with the -c++ option:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Vector</span> <span class="o">*</span><span class="nf">wrap_cross</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v1</span><span class="p">,</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">v2</span><span class="p">)</span> 
<span class="p">{</span>
        <span class="n">Vector</span> <span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="n">v1</span><span class="p">;</span>
        <span class="n">Vector</span> <span class="n">y</span> <span class="o">=</span> <span class="o">*</span><span class="n">v2</span><span class="p">;</span>
        <span class="n">Vector</span> <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span> <span class="c1">// Uses default copy constructor
</span>        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>In both cases, SWIG allocates a new object and returns a reference to it.
It is up to the user to delete the returned object when it is no longer in use.</p>

<p>Clearly, this will leak memory if you are unaware of the implicit memory
allocation and don’t take steps to free the result.</p>

<p>It should also be noted that the handling of pass/return by value in C++ has
some special cases.</p>

<p>For example, the above code fragments don’t work correctly if Vector doesn’t
define a default constructor. The section on SWIG and C++ has more
 information about this case.</p>

<h3 id="543-linking-to-global-structure-variables">5.4.3 Linking to global structure variables</h3>
<p>For example, a global variable like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Vector</span> <span class="n">unit_i</span><span class="p">;</span>
</code></pre>
</div>
<p>gets mapped to an underlying pair of set/get functions like this :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Vector</span> <span class="o">*</span><span class="nf">unit_i_get</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">unit_i</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">unit_i_set</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">unit_i</span> <span class="o">=</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p>A global variable created in this manner will show up as a pointer in the
target scripting language. It would be an extremely bad idea to free or
destroy such a pointer.</p>

<p>Also, C++ classes must supply a properly defined copy constructor in order
for assignment to work correctly.</p>

<h3 id="544-linking-to-char">5.4.4 Linking to char*</h3>
<p>When a global variable of type char * appears, SWIG uses malloc() or new
to allocate memory for the new value.</p>

<p>Specifically, if you have a variable like this</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">foo</span><span class="p">;</span>
</code></pre>
</div>
<p>SWIG generates the following code:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* C mode */</span>
<span class="kt">void</span> <span class="nf">foo_set</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="n">free</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/* C++ mode.  When -c++ option is used */</span>
<span class="kt">void</span> <span class="nf">foo_set</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="k">delete</span> <span class="p">[]</span> <span class="n">foo</span><span class="p">;</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p>If this is not the behavior that you want, consider making the variable
read-only using the %immutable directive.</p>

<p>Alternatively, you might write a short assist-function to set the value
exactly like you want. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="kr">inline</span> <span class="o">%</span><span class="p">{</span>
    <span class="kt">void</span> <span class="n">set_foo</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">strncpy</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
    <span class="p">}</span>
<span class="o">%</span><span class="p">}</span>
</code></pre>
</div>
<p>Note: If you write an assist function like this, you will have to call it 
as a function from the target scripting language (it does not work like a variable). 
For example, in Python you will have to write:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">set_foo</span><span class="p">(</span><span class="s">"Hello World"</span><span class="p">)</span>
</code></pre>
</div>

<p>A common mistake with char * variables is to link to a variable declared like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="n">VERSION</span> <span class="o">=</span> <span class="s">"1.0"</span><span class="p">;</span>
</code></pre>
</div>
<p>In this case, the variable will be readable, but any attempt to change the 
value results in a segmentation or general protection fault.</p>

<p>This is due to the fact that SWIG is trying to release the old value using 
free or delete when the string literal value currently assigned to the variable 
wasn’t allocated using malloc() or new.</p>

<p>To fix this behavior, you can either:</p>
<ol>
  <li>mark the variable as read-only,</li>
  <li>write a typemap (as described in Chapter 6),</li>
  <li>write a special set function as shown.</li>
  <li>declare the variable as an array: <code class="highlighter-rouge">char VERSION[32] = "1.0";</code></li>
</ol>

<h3 id="544-linking-to-const-char">5.4.4 Linking to const char*</h3>
<p>SWIG still generates functions  for setting and getting the value. However,
 the default behavior <em>does not</em> release the previous contents 
(resulting in a possible memory leak).</p>

<p>In fact, you may get a warning message such as this when wrapping 
 such a variable:</p>
<blockquote>
  <p>example.i:20. Typemap warning. Setting const char * variable may leak memory</p>
</blockquote>

<p>The reason for this behavior is that const char * variables are often used 
 to point to string literals. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">foo</span> <span class="o">=</span> <span class="s">"Hello World</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
</code></pre>
</div>
<p>On the other hand, it is legal to change the pointer to point to some other 
value.</p>

<p>When setting a variable of this type, SWIG allocates a new string 
(using malloc or new) and changes the pointer to point to the new value.</p>

<p>However, the following repeated modifications of the value will result in a memory 
leak since the old value is not released by default.</p>

<p><em>Anyway, try to use const char* or char* as read-only.</em></p>

<h3 id="545-arrays">5.4.5 Arrays</h3>
<p>Arrays are fully supported by SWIG, but they are always handled as pointers
instead of mapping them to a special array object or list in the target language.</p>

<p>Thus, the following declarations :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">foobar</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">40</span><span class="p">]);</span>
<span class="kt">void</span> <span class="n">grok</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[]);</span>
<span class="kt">void</span> <span class="n">transpose</span><span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="mi">20</span><span class="p">]);</span>
</code></pre>
</div>
<p>are processed as if they were really declared like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">foobar</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">grok</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">transpose</span><span class="p">(</span><span class="kt">double</span> <span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">)[</span><span class="mi">20</span><span class="p">]);</span>
</code></pre>
</div>
<p>Like C, SWIG <em>does not</em> perform array bounds checking. 
It is up to the user to make sure the pointer points to a suitably 
allocated region of memory.</p>

<p>Multi-dimensional arrays are transformed into a pointer to an array of one 
less dimension. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="p">[</span><span class="mi">10</span><span class="p">];</span>         <span class="c1">// Maps to int *
</span><span class="kt">int</span> <span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">20</span><span class="p">];</span>     <span class="c1">// Maps to int (*)[20]
</span><span class="kt">int</span> <span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">20</span><span class="p">][</span><span class="mi">30</span><span class="p">];</span> <span class="c1">// Maps to int (*)[20][30]
</span></code></pre>
</div>

<p>Array variables are supported, but are read-only by default.
For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span>   <span class="n">a</span><span class="p">[</span><span class="mi">100</span><span class="p">][</span><span class="mi">200</span><span class="p">];</span>
</code></pre>
</div>
<p>In this case, reading the variable ‘a’ returns a pointer of type  <code class="highlighter-rouge">int (*)[200] </code> 
that points to the first element of the array  <code class="highlighter-rouge">&amp;a[0][0] </code>.</p>

<p>Trying to modify ‘a’ results in an error. This is because SWIG does not know 
how to copy data from the target  language into the array.</p>

<p>To work around this limitation,  you may want to write a few simple assist
functions like this: For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="kr">inline</span> <span class="o">%</span><span class="p">{</span>
        <span class="kt">void</span> <span class="n">a_set</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span> 
        <span class="p">{</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">a_get</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> 
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
        <span class="p">}</span>
<span class="o">%</span><span class="p">}</span>
</code></pre>
</div>
<p>In the target language, the value <em>cannot</em> be set/get like a normal variable 
but set/get it like this:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">a_set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c"># set a[0][0] to 1</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">a_get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c"># get a[0][0]</span>
</code></pre>
</div>

<p>To dynamically create arrays of various sizes and shapes, it may be useful
to write some helper functions in your interface. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="c1">// Some array helpers
</span><span class="o">%</span><span class="kr">inline</span> <span class="o">%</span><span class="p">{</span>
    <span class="cm">/* Create any sort of [size] array */</span>
    <span class="kt">int</span> <span class="o">*</span><span class="n">int_array</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="cm">/* Create a two-dimension array [size][10] */</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">int_array_10</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">))[</span><span class="mi">10</span><span class="p">]</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)[</span><span class="mi">10</span><span class="p">])</span> <span class="n">malloc</span><span class="p">(</span><span class="n">size</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
    <span class="p">}</span>
<span class="o">%</span><span class="p">}</span>
</code></pre>
</div>

<p>Arrays of char are handled as a special case by SWIG. In this case, 
strings in the target language can be stored in the array.</p>

<p>For example, if you have a declaration like this,</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">char</span> <span class="n">pathname</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
</code></pre>
</div>
<p>SWIG generates functions for both getting and setting the value that are
equivalent to the following code:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">char</span> <span class="o">*</span><span class="nf">pathname_get</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pathname</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">pathname_set</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The difference is that in the target language, the value <em>can be</em> set/get like
a normal variable.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">pathname</span> <span class="o">=</span> <span class="s">'python'</span> <span class="c"># set</span>
<span class="k">print</span> <span class="n">pathname</span> <span class="c"># get</span>
</code></pre>
</div>

<h3 id="548-defaultoptional-arguments">5.4.8 Default/optional arguments</h3>
<p>For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">plot</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">color</span><span class="o">=</span><span class="n">WHITE</span><span class="p">);</span>
</code></pre>
</div>
<p>SWIG generates wrapper code where the default arguments 
are optional in the target language:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">plot</span> <span class="o">-</span><span class="mf">3.4</span> <span class="mf">7.5</span>    <span class="c"># Use default value</span>
<span class="n">plot</span> <span class="o">-</span><span class="mf">3.4</span> <span class="mf">7.5</span> <span class="mi">10</span> <span class="c"># set color to 10 instead</span>
</code></pre>
</div>

<h3 id="549-pointers-to-functions-and-callbacks">5.4.9 Pointers to functions and callbacks</h3>
<p>SWIG provides full support for function pointers provided that the callback 
functions are defined in C and not in the target language.</p>

<p>For example, consider a function like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">int</span> <span class="n">binary_op</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">op</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">));</span>
</code></pre>
</div>
<p>When you first wrap something like this into an extension module, 
you may find the function to be impossible to use. For instance, in Python:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">def</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">:</span>
<span class="p">...</span>     <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="p">...</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">binary_op</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">add</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span><span class="o">:</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="n">in</span> <span class="o">?</span>
<span class="n">TypeError</span><span class="o">:</span> <span class="n">Type</span> <span class="n">error</span><span class="p">.</span> <span class="n">Expected</span> <span class="n">_p_f_int_int__int</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre>
</div>
<p>The reason for this error is that SWIG doesn’t know how to map a 
scripting language function into a C callback.</p>

<p>However, existing C functions can be used as arguments provided you 
install them as constants. One way to do this is to use the %constant 
directive like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* Function with a callback */</span>
<span class="kt">int</span> <span class="n">binary_op</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">op</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">));</span>
<span class="cm">/* Some callback functions */</span>
<span class="o">%</span><span class="n">constant</span> <span class="kt">int</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="o">%</span><span class="n">constant</span> <span class="kt">int</span> <span class="n">sub</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="o">%</span><span class="n">constant</span> <span class="kt">int</span> <span class="n">mul</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</code></pre>
</div>
<p>In this case, add, sub, and mul become function pointer constants 
in the target scripting language. This allows you to use them as follows:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">binary_op</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">add</span><span class="p">)</span>
<span class="mi">7</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">binary_op</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">mul</span><span class="p">)</span>
<span class="mi">12</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre>
</div>
<p>Unfortunately, by declaring the callback functions as constants, 
they are no longer accessible as functions. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span><span class="o">:</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="n">in</span> <span class="o">?</span>
<span class="n">TypeError</span><span class="o">:</span> <span class="n">object</span> <span class="n">is</span> <span class="n">not</span> <span class="n">callable</span><span class="o">:</span> <span class="err">'</span><span class="n">_ff020efc_p_f_int_int__int</span><span class="err">'</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre>
</div>
<p>If you want to make a function available as both a callback function and 
a function, you can use the %callback and %nocallback directives like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* Function with a callback */</span>
<span class="kt">int</span> <span class="n">binary_op</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">op</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">));</span>
<span class="cm">/* Some callback functions */</span>
<span class="o">%</span><span class="n">callback</span><span class="p">(</span><span class="s">"%s_cb"</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sub</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mul</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="o">%</span><span class="n">nocallback</span><span class="p">;</span>
</code></pre>
</div>
<p><code class="highlighter-rouge">%s</code> gets replaced by the function name. The callback mode remains in 
effect until it is explicitly disabled using <code class="highlighter-rouge">%nocallback</code>. When you do this,
 the interface now works as follows:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">binary_op</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">add_cb</span><span class="p">)</span>
<span class="mi">7</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">binary_op</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">mul_cb</span><span class="p">)</span>
<span class="mi">12</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="mi">7</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mul</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="mi">12</span>
</code></pre>
</div>
<p>Notice that when the function is used as a callback, special names 
such as  <code class="highlighter-rouge">add_cb</code> are used instead. To call the function normally,
just use the original function name such as  <code class="highlighter-rouge">add() </code>.</p>

<blockquote>
  <p>Although SWIG does not normally allow callback functions to be written 
in the target language, this can be accomplished with the use of type maps 
and other advanced SWIG features.</p>
</blockquote>

<p>See the Typemaps chapter for more 
about typemaps and individual target language chapters for more on 
callbacks and the ‘director’ feature.</p>

<h2 id="55-structures-and-unions">5.5 Structures and unions</h2>
<p>If SWIG encounters the definition of a C structure or union, 
it creates a set of accessor functions. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Vector</span> 
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p>gets transformed into the following set of accessor functions :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="kt">double</span> <span class="nf">Vector_x_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="nf">Vector_y_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> 
<span class="p">{</span> 
    <span class="k">return</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="nf">Vector_z_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> 
<span class="p">{</span> 
    <span class="k">return</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">z</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Vector_x_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">double</span> <span class="n">value</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Vector_y_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">double</span> <span class="n">value</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Vector_z_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">double</span> <span class="n">value</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">z</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p>In addition, SWIG creates default constructor and destructor functions if 
none are defined in the interface. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="nf">new_Vector</span><span class="p">()</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="p">)</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span><span class="p">));</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">delete_Vector</span><span class="p">(</span><span class="k">struct</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">free</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>
<p>Using these low-level accessor functions, an object can be minimally 
manipulated from the target language using code like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code> <span class="n">v</span> <span class="o">=</span> <span class="n">new_Vector</span><span class="p">()</span>
<span class="n">Vector_x_set</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Vector_y_set</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">Vector_z_set</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="n">delete_Vector</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</code></pre>
</div>
<p>However, most of SWIG’s language modules also provide a high-level 
interface that is more convenient. Keep reading.</p>

<h3 id="552-char-strings-members">5.5.2 Char* strings members</h3>
<p>Structures involving character strings require some care.</p>

<p>SWIG assumes that all members of type char * have been dynamically 
allocated using malloc() and that they are <em>NULL-terminated</em> ASCII strings.
For example :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">module</span> <span class="n">mymodule</span>
<span class="p">...</span>
<span class="k">struct</span> <span class="n">Foo</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span>
</code></pre>
</div>
<p>This results in the following accessor functions :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="c1">// Note: If the -c++ option is used, new and delete are used to perform memory allocation.
</span><span class="kt">char</span> <span class="o">*</span><span class="nf">Foo_name_get</span><span class="p">(</span><span class="n">Foo</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">Foo_name_set</span><span class="p">(</span><span class="n">Foo</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span>
        <span class="n">free</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
    <span class="n">obj</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">strcpy</span><span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p>If this behavior differs from what you need in your applications, 
the SWIG “memberin” typemap can be used to change it. 
See the typemaps chapter for further details.</p>

<h3 id="553-array-members">5.5.3 Array members</h3>
<p>Arrays may appear as the members of structures, but they will be 
read-only by default. SWIG may generate a warning message:</p>
<blockquote>
  <p>interface.i:116. Warning. Array member will be read-only</p>
</blockquote>

<p>To eliminate the warning message, typemaps can be used, 
but this is discussed in a later chapter. In many cases, 
the warning message is <em>harmless</em>.</p>

<p>5.5.4 Structure data members
Occasionally, a structure will contain data members that are themselves 
structures. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">Foo</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Foo</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">Bar</span> 
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
    <span class="n">Foo</span> <span class="n">f</span><span class="p">;</span>  <span class="cm">/* Structure data member */</span>
<span class="p">}</span> <span class="n">Bar</span><span class="p">;</span>
</code></pre>
</div>
<p>When a structure member is wrapped, it is handled as a pointer, 
unless the %naturalvar directive is used where it is handled more like a 
C++ reference (see C++ Member data).</p>

<p>The accessors to the member variable as a pointer are effectively 
wrapped as follows:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Foo</span> <span class="o">*</span><span class="nf">Bar_f_get</span><span class="p">(</span><span class="n">Bar</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Bar_f_set</span><span class="p">(</span><span class="n">Bar</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">Foo</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">b</span><span class="o">-&gt;</span><span class="n">f</span> <span class="o">=</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<p>The reasons for this are have to do with the problem of modifying and 
accessing data inside the data member. For example, suppose you 
wanted to modify f.x in C like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Bar</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
<span class="n">b</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>
</code></pre>
</div>
<p>Translating them to function calls in C (as would be used inside 
the scripting language interface) results in the following code:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Bar</span> <span class="o">*</span><span class="n">b</span><span class="p">;</span>
<span class="n">Foo_x_set</span><span class="p">(</span><span class="n">Bar_f_get</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="mi">37</span><span class="p">);</span>
</code></pre>
</div>
<p>In this code, if the <em>Bar_f_get()</em> function were to return a <em>Foo</em> instead of a 
<em>Foo*</em>, then the resulting modification would be applied to a copy of f and
not the data member f itself. Clearly that’s not what you want!</p>

<p>It should be noted that <em>this transformation to pointers</em> only occurs
if SWIG knows that a data member is a structure or class. 
For instance, if you had a structure like this,</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">struct</span> <span class="n">Foo</span> 
<span class="p">{</span>
    <span class="n">WORD</span>   <span class="n">w</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>
<p><em>and nothing was known about WORD,</em> then SWIG will generate more 
normal accessor functions like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">WORD</span> <span class="nf">Foo_w_get</span><span class="p">(</span><span class="n">Foo</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">w</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Foo_w_set</span><span class="p">(</span><span class="n">FOO</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">WORD</span> <span class="n">value</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="n">f</span><span class="o">-&gt;</span><span class="n">w</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
<blockquote>
  <p><strong>Compatibility Note:</strong> if you need to tell SWIG that an undeclared datatype is really a struct, 
simply use a forward struct declaration such as “struct Foo;”.</p>
</blockquote>

<h3 id="555-c-constructors-and-destructors">5.5.5 C constructors and destructors</h3>
<p>When wrapping structures, it is generally useful to have a mechanism for
creating and destroying objects</p>

<p>As there may be memory allocations happening when constructing 
structures that should be released when destruction.</p>

<p>SWIG will by default automatically generate functions for creating and 
destroying objects using malloc() and free() when SWIG is <em>used on C code</em>,
with C++ being handled differently.</p>

<p>If you don’t want SWIG to generate default constructors for your interfaces, 
you can use the <code class="highlighter-rouge">%nodefaultctor</code> directive or the <code class="highlighter-rouge">-nodefaultctor</code>
command line option. For example:</p>
<blockquote>
  <p>swig -nodefaultctor example.i</p>
</blockquote>

<p>or</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">module</span> <span class="n">foo</span>
<span class="p">...</span>
<span class="o">%</span><span class="n">nodefaultctor</span><span class="p">;</span>        <span class="c1">// Don't create default constructors
</span><span class="p">...</span> <span class="n">declarations</span> <span class="p">...</span>
<span class="o">%</span><span class="n">clearnodefaultctor</span><span class="p">;</span>   <span class="c1">// Re-enable default constructors
</span></code></pre>
</div>
<p>If you need more precise control, <code class="highlighter-rouge">%nodefaultctor</code> can selectively target 
individual structure definitions. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">nodefaultctor</span> <span class="n">Foo</span><span class="p">;</span> <span class="c1">// No default constructor for Foo
</span><span class="p">...</span>
<span class="k">struct</span> <span class="n">Foo</span> 
<span class="p">{</span>             
    <span class="c1">// No default constructor generated.
</span><span class="p">};</span>
<span class="k">struct</span> <span class="n">Bar</span> 
<span class="p">{</span>             
    <span class="c1">// Default constructor generated.
</span><span class="p">};</span>
</code></pre>
</div>

<p><em>Since ignoring the implicit or default destructors most of the time produces 
memory leaks, SWIG will always try to generate them.</em></p>

<p>If needed, however, you can selectively disable the generation of the 
default/implicit destructor by using <code class="highlighter-rouge">%nodefaultdtor</code>:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">nodefaultdtor</span> <span class="n">Foo</span><span class="p">;</span> <span class="c1">// No default/implicit destructor for Foo
</span><span class="p">...</span>
<span class="k">struct</span> <span class="n">Foo</span> 
<span class="p">{</span>              
    <span class="c1">// No default destructor is generated.
</span><span class="p">};</span>
<span class="k">struct</span> <span class="n">Bar</span> 
<span class="p">{</span>              
    <span class="c1">// Default destructor generated.
</span><span class="p">};</span>
</code></pre>
</div>

<p><strong>Note:</strong> There are also the <code class="highlighter-rouge">-nodefault</code> option and <code class="highlighter-rouge">%nodefault</code> directive, 
which disable both the default or implicit destructor generation. 
<em>This could lead to memory leaks across the target languages, 
and it is highly recommended you don’t use them.</em></p>

<h3 id="556-adding-member-functions-to-c-structures">5.5.6 Adding member functions to C structures</h3>
<p>SWIG provides a special %extend directive that makes it possible to attach 
methods to C structures for purposes of building an object oriented interface. 
Suppose you have a C header file with the following declaration :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* file : vector.h */</span>
<span class="p">...</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">Vector</span> 
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Vector</span><span class="p">;</span>
</code></pre>
</div>
<p>You can make a Vector look a lot like a class by writing a SWIG 
interface like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="c1">// file : vector.i
</span><span class="o">%</span><span class="n">module</span> <span class="n">mymodule</span>
<span class="o">%</span><span class="p">{</span>
        <span class="cp">#include "vector.h"
</span><span class="o">%</span><span class="p">}</span>

<span class="o">%</span><span class="n">include</span> <span class="s">"vector.h"</span>          <span class="c1">// Just grab original C header file
</span><span class="o">%</span><span class="n">extend</span> <span class="n">Vector</span> 
<span class="p">{</span>             
    <span class="c1">// Attach these functions to struct Vector.
</span>    <span class="c1">// The newly constructed object must be returned as if the constructor 
</span>    <span class="c1">// declaration had a return value, a Vector * in this case.
</span>    <span class="n">Vector</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">,</span> <span class="kt">double</span> <span class="n">z</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Vector</span><span class="p">));</span>
        <span class="n">v</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
        <span class="n">v</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
        <span class="n">v</span><span class="o">-&gt;</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">~</span><span class="n">Vector</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">free</span><span class="p">(</span><span class="err">$</span><span class="n">self</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">double</span> <span class="n">magnitude</span><span class="p">()</span> 
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">*</span><span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">+</span><span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">y</span><span class="o">*</span><span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">y</span><span class="o">+</span><span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">z</span><span class="o">*</span><span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">z</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">print</span><span class="p">()</span> 
    <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Vector [%g, %g, %g]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">,</span> <span class="err">$</span><span class="n">self</span><span class="o">-&gt;</span><span class="n">z</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre>
</div>
<p>Note the usage of the <code class="highlighter-rouge">$self</code> special variable. Its usage is identical to a 
C++ ‘this’ pointer and should be used whenever access to the struct 
instance is required.</p>

<p>Now, when used with proxy classes in Python, you can do things like this :</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">v</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>                 <span class="c"># Create a new vector</span>
<span class="k">print</span> <span class="n">v</span><span class="o">.</span><span class="n">magnitude</span><span class="p">()</span>                <span class="c"># Print magnitude</span>
<span class="c"># 5.0</span>
<span class="n">v</span><span class="o">.</span><span class="k">print</span><span class="p">()</span>                  <span class="c"># Print it out</span>
<span class="c"># [ 3, 4, 0 ]</span>
<span class="k">del</span> <span class="n">v</span>                      <span class="c"># Destroy it</span>
</code></pre>
</div>
<hr />
<p>The %extend directive can also be used inside the definition of the 
Vector structure. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="c1">// file : vector.i
</span><span class="o">%</span><span class="n">module</span> <span class="n">mymodule</span>
<span class="o">%</span><span class="p">{</span>
        <span class="cp">#include "vector.h"
</span><span class="o">%</span><span class="p">}</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">Vector</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
  <span class="o">%</span><span class="n">extend</span> <span class="p">{</span>
    <span class="n">Vector</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">,</span> <span class="kt">double</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="o">~</span><span class="n">Vector</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="n">Vector</span><span class="p">;</span>
</code></pre>
</div>
<p>Note that %extend can be used to access externally written functions 
provided they follow the naming convention used in this example :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* File : vector.c */</span>
<span class="cm">/* Vector methods */</span>

<span class="cp">#include "vector.h"
</span>
<span class="n">Vector</span> <span class="o">*</span><span class="nf">new_Vector</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="n">y</span><span class="p">,</span> <span class="kt">double</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">;</span>
  <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Vector</span><span class="p">));</span>
  <span class="n">v</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
  <span class="n">v</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
  <span class="n">v</span><span class="o">-&gt;</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">v</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">delete_Vector</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">free</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="nf">Vector_magnitude</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">*</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">+</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">y</span><span class="o">*</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">y</span><span class="o">+</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">z</span><span class="o">*</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">z</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// File : vector.i
// Interface file
</span><span class="o">%</span><span class="n">module</span> <span class="n">mymodule</span>
<span class="o">%</span><span class="p">{</span>
<span class="cp">#include "vector.h"
</span><span class="o">%</span><span class="p">}</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">Vector</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
  <span class="o">%</span><span class="n">extend</span> <span class="p">{</span>
    <span class="n">Vector</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span> <span class="c1">// This calls new_Vector()
</span>    <span class="o">~</span><span class="n">Vector</span><span class="p">();</span>           <span class="c1">// This calls delete_Vector()
</span>    <span class="kt">double</span> <span class="n">magnitude</span><span class="p">();</span>  <span class="c1">// This will call Vector_magnitude()
</span>    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="n">Vector</span><span class="p">;</span>
</code></pre>
</div>
<p>The name used for %extend should be the name of the struct and not the
 name of any typedef to the struct. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">Integer</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Int</span><span class="p">;</span>
<span class="o">%</span><span class="n">extend</span> <span class="n">Integer</span> <span class="p">{</span> <span class="p">...</span>  <span class="p">}</span> <span class="cm">/* Correct name */</span>
<span class="o">%</span><span class="n">extend</span> <span class="n">Int</span> <span class="p">{</span> <span class="p">...</span>  <span class="p">}</span> <span class="cm">/* Incorrect name */</span>

<span class="k">struct</span> <span class="n">Float</span> <span class="p">{</span>
  <span class="kt">float</span> <span class="n">value</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">Float</span> <span class="n">FloatValue</span><span class="p">;</span>
<span class="o">%</span><span class="n">extend</span> <span class="n">Float</span> <span class="p">{</span> <span class="p">...</span>  <span class="p">}</span> <span class="cm">/* Correct name */</span>
<span class="o">%</span><span class="n">extend</span> <span class="n">FloatValue</span> <span class="p">{</span> <span class="p">...</span>  <span class="p">}</span> <span class="cm">/* Incorrect name */</span>
</code></pre>
</div>
<p>There is one exception to this rule and that is when the struct is 
anonymously named such as:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">double</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Double</span><span class="p">;</span>
<span class="o">%</span><span class="n">extend</span> <span class="n">Double</span> <span class="p">{</span> <span class="p">...</span>  <span class="p">}</span> <span class="cm">/* Okay */</span>
</code></pre>
</div>
<hr />
<p><em>A little known feature</em> of the <code class="highlighter-rouge">%extend</code> directive is that it can also be used 
to add synthesized attributes or to modify the behavior of existing data 
attributes.</p>

<p>For example, suppose you wanted to make magnitude a read-only attribute 
of Vector instead of a method. To do this, you might write some code like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="c1">// Add a new attribute to Vector
</span><span class="o">%</span><span class="n">extend</span> <span class="n">Vector</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">double</span> <span class="n">magnitude</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Now supply the implementation of the Vector_magnitude_get function
</span><span class="o">%</span><span class="p">{</span>
<span class="k">const</span> <span class="kt">double</span> <span class="n">Vector_magnitude_get</span><span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">const</span> <span class="kt">double</span><span class="p">)</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">*</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">+</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">y</span><span class="o">*</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">y</span><span class="o">+</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">z</span><span class="o">*</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">z</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">%</span><span class="p">}</span>
</code></pre>
</div>
<p>Now, for all practical purposes, magnitude will appear like an 
attribute of the object.</p>

<p>A similar technique can also be used to work with data members that you 
want to process. For example, consider this interface:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">Person</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
  <span class="p">...</span>
<span class="p">}</span> <span class="n">Person</span><span class="p">;</span>
</code></pre>
</div>
<p>Say you wanted to ensure name was always upper case, you can rewrite
the interface as follows to ensure this occurs whenever a name is read 
or written to:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">Person</span> <span class="p">{</span>
  <span class="o">%</span><span class="n">extend</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span> <span class="n">Person</span><span class="p">;</span>

<span class="o">%</span><span class="p">{</span>
<span class="cp">#include &lt;string.h&gt;
#include &lt;ctype.h&gt;
</span><span class="kt">void</span> <span class="n">make_upper</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="n">name</span><span class="p">;</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span> <span class="o">++</span><span class="n">c</span><span class="p">)</span>
    <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">toupper</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Specific implementation of set/get functions forcing capitalization */</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">Person_name_get</span><span class="p">(</span><span class="n">Person</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">make_upper</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Person_name_set</span><span class="p">(</span><span class="n">Person</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">strncpy</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
  <span class="n">make_upper</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">%</span><span class="p">}</span>
</code></pre>
</div>
<p><strong>Note:</strong> it should be stressed that even though <code class="highlighter-rouge">%extend</code> can be used to 
add new data members, these new members can not require the allocation
of additional storage in the object (e.g., their values must be entirely 
synthesized from existing attributes of the structure or obtained elsewhere).</p>

<h3 id="557-nested-structures">5.5.7 Nested structures</h3>
<p>Occasionally, a C program will involve structures like this :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code> <span class="k">typedef</span> <span class="k">struct</span> <span class="n">Object</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">objtype</span><span class="p">;</span>
  <span class="k">union</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">ivalue</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">dvalue</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">strvalue</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">ptrvalue</span><span class="p">;</span>
  <span class="p">}</span> <span class="n">intRep</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Object</span><span class="p">;</span>
</code></pre>
</div>
<p>When SWIG encounters this, it performs a structure splitting operation that 
transforms the declaration into the equivalent of the following:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">ivalue</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">dvalue</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">strvalue</span><span class="p">;</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">ptrvalue</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Object_intRep</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">Object</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">objType</span><span class="p">;</span>
  <span class="n">Object_intRep</span> <span class="n">intRep</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Object</span><span class="p">;</span>
</code></pre>
</div>
<p>SWIG will then create an Object_intRep structure for use inside the 
interface file. Accessor functions will be created for both structures. 
In this case, functions like this would be created :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="n">Object_intRep</span> <span class="o">*</span><span class="nf">Object_intRep_get</span><span class="p">(</span><span class="n">Object</span> <span class="o">*</span><span class="n">o</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Object_intRep</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">o</span><span class="o">-&gt;</span><span class="n">intRep</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">Object_intRep_ivalue_get</span><span class="p">(</span><span class="n">Object_intRep</span> <span class="o">*</span><span class="n">o</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="n">o</span><span class="o">-&gt;</span><span class="n">ivalue</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">Object_intRep_ivalue_set</span><span class="p">(</span><span class="n">Object_intRep</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">o</span><span class="o">-&gt;</span><span class="n">ivalue</span> <span class="o">=</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">double</span> <span class="nf">Object_intRep_dvalue_get</span><span class="p">(</span><span class="n">Object_intRep</span> <span class="o">*</span><span class="n">o</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">return</span> <span class="n">o</span><span class="o">-&gt;</span><span class="n">dvalue</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">...</span> <span class="n">etc</span> <span class="p">...</span>
</code></pre>
</div>
<p>Although this process is a little hairy, it works like you would expect in the 
target scripting language–especially when proxy classes are used. 
For instance, in Perl:</p>
<div class="language-perl highlighter-rouge"><pre class="highlight"><code><span class="c1"># Perl5 script for accessing nested member</span>
<span class="nv">$o</span> <span class="o">=</span> <span class="nv">CreateObject</span><span class="p">();</span>                    <span class="c1"># Create an object somehow</span>
<span class="nv">$o</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">intRep</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">ivalue</span><span class="p">}</span> <span class="o">=</span> <span class="mi">7</span>              <span class="c1"># Change value of o.intRep.ivalue</span>
</code></pre>
</div>
<p><strong>Note:</strong>   if you have a lot of nested structure declarations, it is advisable to 
double-check them after running SWIG. Nesting is handled differently in 
C++ mode, see Nested classes.</p>

<h2 id="56-code-insertion">5.6 Code Insertion</h2>
<p>Sometimes it is necessary to insert special code into the resulting wrapper
file generated by SWIG. For example, you may want to include additional 
C code to perform initialization or other operations.</p>

<p>There are four common ways to insert code, but it’s useful to know how
the output of SWIG is structured first.</p>

<h3 id="561-the-output-of-swig">5.6.1 The output of SWIG</h3>
<p>When SWIG creates its output C/C++ file, it is broken up into five sections:</p>
<ul>
  <li><em>Begin section</em>  <br />
 A placeholder for users to put code at the beginning of the C/C++ 
 wrapper file. This is most often used to define preprocessor macros 
 that are used in later sections.</li>
  <li><em>Runtime code</em>  <br />
 This code is internal to SWIG and is used to include type-checking and 
 other support functions that are used by the rest of the module.</li>
  <li><em>Header section</em>  <br />
 This is user-defined support code that has been included by the %{ … %} 
 directive. Usually this consists of header files and other helper functions.</li>
  <li><em>Wrapper code</em>  <br />
 These are the wrappers generated automatically by SWIG.</li>
  <li><em>Module initialization</em>  <br />
 The function generated by SWIG to initialize the module upon loading.</li>
</ul>

<h3 id="562-code-insertion-blocks">5.6.2 Code insertion blocks</h3>
<p>The %insert directive enables inserting blocks of code into a given section 
of the generated code. It can be used in one of two ways:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">insert</span><span class="p">(</span><span class="s">"section"</span><span class="p">)</span> <span class="s">"filename"</span>
<span class="o">%</span><span class="n">insert</span><span class="p">(</span><span class="s">"section"</span><span class="p">)</span> <span class="o">%</span><span class="p">{</span> <span class="p">...</span> <span class="o">%</span><span class="p">}</span>
</code></pre>
</div>
<p>For example, %runtime is used instead of %insert(“runtime”). The valid sections
and order of the sections in the generated C/C++ wrapper file is as shown:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">begin</span> <span class="o">%</span><span class="p">{</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">in</span> <span class="n">begin</span> <span class="n">section</span> <span class="p">...</span>
<span class="o">%</span><span class="p">}</span>
<span class="o">%</span><span class="n">runtime</span> <span class="o">%</span><span class="p">{</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">in</span> <span class="n">runtime</span> <span class="n">section</span> <span class="p">...</span>
<span class="o">%</span><span class="p">}</span>
<span class="o">%</span><span class="n">header</span> <span class="o">%</span><span class="p">{</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">in</span> <span class="n">header</span> <span class="n">section</span> <span class="p">...</span>
<span class="o">%</span><span class="p">}</span>
<span class="o">%</span><span class="n">wrapper</span> <span class="o">%</span><span class="p">{</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">in</span> <span class="n">wrapper</span> <span class="n">section</span> <span class="p">...</span>
<span class="o">%</span><span class="p">}</span>
<span class="o">%</span><span class="n">init</span> <span class="o">%</span><span class="p">{</span>
  <span class="p">...</span> <span class="n">code</span> <span class="n">in</span> <span class="n">init</span> <span class="n">section</span> <span class="p">...</span>
<span class="o">%</span><span class="p">}</span>
</code></pre>
</div>
<p><strong>Note:</strong> the bare %{ … %} directive is a shortcut that is the same as 
<code class="highlighter-rouge">%header %{ ... %}</code>.</p>

<p>A common use for code blocks is to write “helper” functions. These are 
functions that are used specifically for the purpose of building an interface, 
<em>but which are generally not visible to the normal C program</em>. For example:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="p">{</span>
   <span class="cm">/* Create a new vector */</span>
   <span class="k">static</span> <span class="n">Vector</span> <span class="o">*</span><span class="n">new_Vector</span><span class="p">()</span> 
   <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Vector</span><span class="p">));</span>
   <span class="p">}</span>
<span class="o">%</span><span class="p">}</span>

<span class="c1">// Now tell SWIG to warp and expose it to script world 
</span><span class="n">Vector</span> <span class="o">*</span><span class="n">new_Vector</span><span class="p">();</span>
</code></pre>
</div>
<h3 id="563-inlined-header-code-blocks">5.6.3 Inlined header code blocks</h3>
<p>Since the process of writing helper functions is fairly common, there is a special 
inlined form of code block that is used as follows :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="kr">inline</span> 
<span class="o">%</span><span class="p">{</span>
   <span class="c1">// Create a new vector and at the same time 
</span>   <span class="c1">// tell SWIG to warp and expose it to script world
</span>   <span class="n">Vector</span> <span class="o">*</span><span class="n">new_Vector</span><span class="p">()</span> 
   <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">Vector</span> <span class="o">*</span><span class="p">)</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Vector</span><span class="p">));</span>
   <span class="p">}</span>
<span class="o">%</span><span class="p">}</span>
</code></pre>
</div>
<p>The %inline directive inserts all of the code that follows verbatim into the header 
portion of an interface file.</p>

<p>The code is then parsed by both the SWIG preprocessor and parser. Thus, the above 
example creates a new command new_Vector using only one declaration.</p>

<h3 id="564-initialization-blocks">5.6.4 Initialization blocks</h3>
<p>When code is included in the %init section, it is copied directly into the module 
initialization function. For example, if you needed to perform some extra initialization 
on module loading, you could write this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">init</span> <span class="o">%</span><span class="p">{</span><span class="n">init_variables</span><span class="p">();</span><span class="o">%</span><span class="p">}</span>
</code></pre>
</div>

<h2 id="57-interface-building-strategy">5.7 Interface Building Strategy</h2>
<p>This section describes the general approach for building interfaces with SWIG. The specifics 
related to a particular scripting language are found in later chapters.</p>
<h3 id="571-preparing-a-c-program-for-swig">5.7.1 Preparing a C program for SWIG</h3>
<p>Here’s a series of steps you can follow to make an interface for a C program :</p>
<ol>
  <li><em>Identify the functions that you want to wrap.</em>  <br />
It’s probably not necessary to access every single function of a C program–thus, a little 
forethought can dramatically simplify the resulting scripting language interface. C header 
files are a particularly good source for finding things to wrap.</li>
  <li><em>Create a new interface file to describe the scripting language interface to your program.</em></li>
  <li><em>Copy the appropriate declarations into the interface file or use SWIG’s %include directive 
 to process an entire C source/header file.</em></li>
  <li><em>Make sure everything in the interface file uses ANSI C/C++ syntax.</em></li>
  <li><em>Most importantly, define a type before it is used!</em>  <br />
Make sure all necessary typedef declarations and type-information is available in the interface file.
if type information is not specified correctly, the wrappers can be sub-optimal and even result
in uncompilable C/C++ code.</li>
  <li><em>If your program has a main() function, you may need to rename it (read on).</em></li>
  <li><em>Run SWIG and compile.</em><br />
Although this may sound complicated, the process turns out to be fairly easy once you get the 
hang of it.</li>
</ol>

<p><strong>Note:</strong> In the process of building an interface, SWIG may encounter syntax errors or other problems. 
The best way to deal with this is to simply copy the offending code into a separate interface file and 
edit it.</p>

<h3 id="572-swig-interface-file">5.7.2 SWIG interface file</h3>
<p>The preferred method of using SWIG is to generate a separate interface file. Suppose you have the 
following C header file :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* File : header.h */</span>
<span class="cp">#include &lt;stdio.h&gt;
#include &lt;math.h&gt;
</span><span class="k">extern</span> <span class="kt">int</span> <span class="n">foo</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">double</span> <span class="n">bar</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">dump</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">);</span>
</code></pre>
</div>
<p>A typical SWIG interface file for this header file would look like the following :</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* File : interface.i */</span>
<span class="o">%</span><span class="n">module</span> <span class="n">mymodule</span>
<span class="o">%</span><span class="p">{</span>
    <span class="cp">#include "header.h"
</span><span class="o">%</span><span class="p">}</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">foo</span><span class="p">(</span><span class="kt">double</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">double</span> <span class="n">bar</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">dump</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">);</span>
</code></pre>
</div>
<p>Of course, in this case, our header file is pretty simple so we could use a simpler 
approach and use an interface file like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cm">/* File : interface.i */</span>
<span class="o">%</span><span class="n">module</span> <span class="n">mymodule</span>
<span class="o">%</span><span class="p">{</span>
    <span class="cp">#include "header.h"
</span><span class="o">%</span><span class="p">}</span>
<span class="o">%</span><span class="n">include</span> <span class="s">"header.h"</span>
</code></pre>
</div>
<p>The main advantage of this approach is minimal maintenance of an interface file for when 
the header file changes in the future.</p>

<p><strong>Note:</strong> in more complex projects, an interface file containing numerous %include and #include 
statements like this is one of the most common approaches to interface file design due 
to lower maintenance overhead.</p>

<h3 id="573-why-use-separate-interface-files">5.7.3 Why use separate interface files?</h3>
<p>Although SWIG can parse many header files, it is more common to write a special .i file defining 
the interface to a package. There are several reasons why you might want to do this:</p>
<ol>
  <li><em>It is rarely necessary to access every single function in a large package.</em> 
Many C functions might have little or no use in a scripted environment. Therefore, why wrap them?</li>
  <li><em>Separate interface files provide an opportunity to provide more precise rules about how an 
 interface is to be constructed.</em></li>
  <li><em>Interface files can provide more structure and organization.</em></li>
  <li><em>SWIG can’t parse certain definitions that appear in header files.</em> 
Having a separate file allows you to eliminate or work around these problems.</li>
  <li><em>Interface files provide a more precise definition of what the interface is.</em> 
Users wanting to extend the system can go to the interface file and immediately see what is available 
without having to dig it out of header files.</li>
</ol>

<h3 id="574-getting-the-right-header-files">5.7.4 Getting the right header files</h3>
<p><strong>Note:</strong> Sometimes, it is necessary to use certain header files in order for the code generated by 
SWIG to compile properly. Make sure you include certain header files by using a %{ %} block like this:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="o">%</span><span class="n">module</span> <span class="n">graphics</span>
<span class="o">%</span><span class="p">{</span>
   <span class="cp">#include &lt;GL/gl.h&gt;
</span>   <span class="cp">#include &lt;GL/glu.h&gt;
</span><span class="o">%</span><span class="p">}</span>
<span class="c1">// Put the rest of the declarations here
</span><span class="p">...</span>
</code></pre>
</div>

<h3 id="575-what-to-do-with-main">5.7.5 What to do with main()</h3>
<p>If your program defines a main() function, you may need to get rid of it or rename it in order to use 
a scripting language. As most scripting languages define their own main() procedure that is called instead.</p>

<p>main() also makes no sense when working with dynamic loading. There are a few approaches to solving the
main() conflict :</p>
<ul>
  <li><em>Get rid of main() entirely.</em></li>
  <li><em>Rename main() to something else. You can do this by compiling your C program with an option like -Dmain=oldmain.</em></li>
  <li><em>Use conditional compilation to only include main() when not using a scripting language.</em></li>
</ul>

<p><strong>Note:</strong> getting rid of main() may cause potential initialization problems of a program. To handle this problem, 
you may consider writing a special function called program_init() that initializes your program upon startup.</p>

<p>This function could then be called either from the scripting language as the first operation, or when the SWIG 
generated module is loaded. In many cases, the old main() program can be completely replaced by a Perl, Python, 
or Tcl script.</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/03/20/swig-3-wrap-c/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/03/18/lock-free-multi-process-shared-memory/">lock-free-multi-process-shared-memory</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-03-18
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#ipc" title="Category: ipc" rel="category">ipc</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#os" title="Tag: os" rel="tag">os</a>&nbsp;
    
        <a href="/tag/#lock-free" title="Tag: lock-free" rel="tag">lock-free</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#how-to-make-lock-free-ipc-communication-between" id="markdown-toc-how-to-make-lock-free-ipc-communication-between">How to make lock free ipc communication between</a>    <ul>
      <li><a href="#option-1" id="markdown-toc-option-1">OPTION 1:</a></li>
      <li><a href="#option2" id="markdown-toc-option2">OPTION2:</a></li>
    </ul>
  </li>
</ul>

<h3 id="how-to-make-lock-free-ipc-communication-between">How to make lock free ipc communication between</h3>
<p>a single writer and a single reader via shared-memory ?</p>

<h4 id="option-1">OPTION 1:</h4>
<p>two fifo q1 and q2 used to simlate biodirectional data flows bwtween p1 and p2.</p>

<p>no lock required at all. queue refers to linux lock free queue.</p>

<p>q1: t1 as writer and t2 as reader so single data flow p1—&gt;p2<br />
q2: t1 as reader and t2 as writer so single data flow p1&lt;—p2</p>

<p>when writer writes all buffer, return error code of ENOBUF to 
caller just as socket does</p>

<h4 id="option2">OPTION2:</h4>
<p>这种单独单写的连原子操作都不需要，更不要说mutex之类的了。</p>

<p>假设A,B两进程通信</p>

<p>首先，将共享内存区域分成n块，如何分自己定义。</p>

<p>其次，每块内存指定一个byte做标志，</p>

<p>定义为: 0为A可读写状态，B不可读写；<br />
       1为B可读写状态，A不可读写。<br />
A的行为：
          遍历n块内存，找到一个标志为0的：
          接收：
          查看是否有B发来的消息，有，则接收，设置为可发送状态；
          发送：消息复制到该块区域，设置标志为1；
B的行为:
          遍历n块内存，找到一个标志为1的：
          接收：
          查看是否有B发来的消息，有，则接收，设置为可发送状态；
          发送：消息复制到该块区域，设置标志为0；</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/03/18/lock-free-multi-process-shared-memory/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
              <li>
                <h2>
                  <a class="post-link" href="/2016/03/17/swig-1-intro/">SWIG-1: Introductions</a>
                </h2>
                <div class="label">
                    <div class="label-card">
                        <i class="fa fa-calendar"></i>2016-03-17
                    </div>
                    <div class="label-card">
                        
                    </div>
                    <div class="label-card">
                        
                    </div>

                    <div class="label-card">
                    


<!-- <span class="point">•</span> -->
<span class="categories">
  <i class="fa fa-th-list"></i>
  
    
        <a href="/category/#tool" title="Category: tool" rel="category">tool</a>
    
  

  <!-- <span class="point">•</span> -->
</span>


                    </div>

                    <div class="label-card">
                    
<!-- <span class="point">•</span> -->
<span class="pageTag">
  <i class="fa fa-tags"></i>
  
    
        <a href="/tag/#swig" title="Tag: swig" rel="tag">swig</a>&nbsp;
    
        <a href="/tag/#script-language" title="Tag: script-language" rel="tag">script-language</a>&nbsp;
    
        <a href="/tag/#c/c++" title="Tag: c/c++" rel="tag">c/c++</a>
    
  

</span>

                    </div>
                </div>
                <div class="excerpt">
                    <ul id="markdown-toc">
  <li><a href="#21-what-is-swig" id="markdown-toc-21-what-is-swig">2.1 What is SWIG?</a></li>
  <li><a href="#22-why-use-swig" id="markdown-toc-22-why-use-swig">2.2 Why use SWIG?</a></li>
  <li><a href="#24-supported-cc-language-features" id="markdown-toc-24-supported-cc-language-features">2.4 Supported C/C++ language features</a></li>
  <li><a href="#18-backwards-compatibility" id="markdown-toc-18-backwards-compatibility">1.8 Backwards compatibility</a></li>
  <li><a href="#112-installation" id="markdown-toc-112-installation">1.12 Installation</a>    <ul>
      <li><a href="#1121-windows-installation" id="markdown-toc-1121-windows-installation">1.12.1 Windows installation</a></li>
      <li><a href="#1122-unix-installation" id="markdown-toc-1122-unix-installation">1.12.2 Unix installation</a></li>
      <li><a href="#1124-testing" id="markdown-toc-1124-testing">1.12.4 Testing</a></li>
      <li><a href="#1125-examples" id="markdown-toc-1125-examples">1.12.5 Examples</a></li>
    </ul>
  </li>
</ul>

<h2 id="21-what-is-swig">2.1 What is SWIG?</h2>
<p>In a nutshell, SWIG is a compiler that takes C/C++ declarations and creates the wrappers needed to access those 
declarations from other languages including Perl, Python, Tcl, Ruby, Guile, and Java.</p>

<p>c++ calling script  is also called callback because c++ calls script and then script calls c++  again.</p>

<p>Possible applications of SWIG include:</p>
<ul>
  <li>Building interpreted interfaces to existing C programs.</li>
  <li>Rapid prototyping and application development.</li>
  <li>Interactive debugging.</li>
  <li>Reengineering or refactoring of legacy software into scripting language components.</li>
  <li>Making a graphical user interface (using Tk for example).</li>
  <li>Testing of C libraries and programs (using scripts).</li>
  <li>Building high performance C modules for scripting languages.</li>
  <li>Making C programming more enjoyable (or tolerable depending on your point of view).</li>
  <li>Impressing your friends.</li>
  <li>Obtaining vast sums of research funding (although obviously not applicable to the author).</li>
</ul>

<h2 id="22-why-use-swig">2.2 Why use SWIG?</h2>
<p>let’s list a few problems with C/C++ programming:</p>
<ul>
  <li>Writing a user interface is rather painful (i.e., consider programming with MFC, X11, GTK, or any number of other
libraries).</li>
  <li>Testing is time consuming (the compile/debug cycle).</li>
  <li>Not easy to reconfigure or customize without recompilation.</li>
  <li>Modularization can be tricky.</li>
  <li>Security concerns (buffer overflows for instance).</li>
</ul>

<h2 id="24-supported-cc-language-features">2.4 Supported C/C++ language features</h2>
<ul>
  <li>Full C99 pre-processing.</li>
  <li>All ANSI C and C++ data types.</li>
  <li>Functions, variables, and constants.</li>
  <li>Classes.</li>
  <li>Single and multiple inheritance.</li>
  <li>Overloaded functions and methods.</li>
  <li>Overloaded operators.</li>
  <li>C++ templates (including member templates, specialization, and partial specialization).</li>
  <li>Namespaces.</li>
  <li>Variable length arguments.</li>
  <li>C++ smart pointers.</li>
</ul>

<h2 id="18-backwards-compatibility">1.8 Backwards compatibility</h2>
<p>If you are a previous user of SWIG, don’t expect SWIG to provide complete backwards compatibility.</p>

<p>If you need to work with different versions of SWIG and backwards compatibility is an issue, you can use the SWIG_VERSION preprocessor symbol which holds the version of SWIG being executed.</p>

<p>SWIG_VERSION is a hexadecimal integer such as 0x010311 (corresponding to SWIG-1.3.11). This can be used in an interface file to define different typemaps, take advantage of different features etc:</p>
<div class="language-c++ highlighter-rouge"><pre class="highlight"><code><span class="cp">#if SWIG_VERSION &gt;= 0x010311
</span><span class="cm">/*Use some fancy new feature */</span>
<span class="cp">#endif
</span></code></pre>
</div>

<h2 id="112-installation">1.12 Installation</h2>
<p>If you checked the code out via Git, you will have to run ./autogen.sh before ./configure.</p>
<h3 id="1121-windows-installation">1.12.1 Windows installation</h3>
<p>The Windows distribution is called swigwin and includes a prebuilt SWIG executable, swig.exe and so ypu do not need to compile it.</p>
<h3 id="1122-unix-installation">1.12.2 Unix installation</h3>
<p>To build and install SWIG, simply type the following:</p>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>./configure
<span class="gp">$ </span>make
<span class="gp">$ </span>make install
</code></pre>
</div>
<p>By default SWIG installs itself in /usr/local. If you need to install SWIG in a different location or in your home directory, use the –prefix option to ./configure. For example:</p>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>./configure --prefix<span class="o">=</span>/home/yourname/projects
<span class="gp">$ </span>make
<span class="gp">$ </span>make install
</code></pre>
</div>
<p>Note: the directory given to –prefix must be an absolute pathname. Do not use the ~ shell-escape to refer to your home 
directory. SWIG won’t work properly if you do this.</p>

<h3 id="1124-testing">1.12.4 Testing</h3>
<p>if you want to test SWIG after building it, a check can be performed on Unix operating systems. 
Type the following: <code class="highlighter-rouge">$ make -k check</code>  you can use parallel make to speed up the check as it does take quite some 
time to run, for example: <code class="highlighter-rouge">$ make -j2 -k check</code></p>

<p>Even if the check fails, there is a pretty good chance SWIG still works correctly — you will just have to mess 
around with one of the examples and some makefiles to get it to work.</p>

<p>Some tests may also fail due to missing dependency packages, eg PCRE or Boost, but this will require careful
analysis of the configure output done during configuration.</p>

<h3 id="1125-examples">1.12.5 Examples</h3>
<p>The Examples directory also includes Visual C++ project 6 (.dsp) files for building some of the examples on Windows. 
Later versions of Visual Studio will convert these old style project files into a current solution file.</p>

<p>Ensure the SWIG executable is as supplied in the SWIG root directory in order for the examples to work. 
Most languages require some environment variables to be set before running Visual C++. Note that Visual 
C++ must be re-started to pick up any changes in environment variables.</p>

<p>Open up an example .dsp file, Visual C++ will create a workspace for you (.dsw file). Ensure the
Release build is selected then do a Rebuild All from the Build menu. The required environment variables are displayed with their
current values.</p>

<p>Python
PYTHON_INCLUDE : Set this to the directory that contains Python.h<br />
PYTHON_LIB : Set this to the python library including path for linking<br />
Example using Python 2.1.1:  <br />
PYTHON_INCLUDE: D:\python21\include<br />
PYTHON_LIB: D:\python21\libs\python21.lib</p>


                </div>
                <div class="read-all">
                    <a  href="/2016/03/17/swig-1-intro/"><i class="fa fa-newspaper-o"></i>Read All</a>
                </div>
                <hr>
              </li>
            
        </ul>



        <!-- Pagination links -->
        <div class="pagination">
          
            <a href="/index.html" class="previous"><i class="fa fa-angle-double-left"></i></a>
            <a href="/page2" class="previous"><i class="fa fa-angle-left"></i></a>
          
          <span class="page_number ">3/3</span>
          
            <span class="next disable"><i class="fa fa-angle-right"></i></span>
            <span class="next disable"><i class="fa fa-angle-double-right"></i></span>
          
        </div>
    </div>
    <!-- <button class="anchor"><i class="fa fa-anchor"></i></button> -->
    <div class="right">
        <div class="wrap">
            <div class="side">
                <div>
                    <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                    Recent Posts
                </div>
                <ul class="content-ul" recent>
                    
                        <li><a href="/2017/03/12/ccia-3-1-shared-data-protection/">CCIA-3-shared-data-1</a></li>
                    
                        <li><a href="/2017/03/07/csapp-1-preface/">CS:APP-1-Introduction</a></li>
                    
                        <li><a href="/2017/03/06/ccia-2-thread-management/">CCIA-2-basic-thread-mangement</a></li>
                    
                        <li><a href="/2017/03/06/grof-jump-floor/">Frog Jump Floor</a></li>
                    
                        <li><a href="/2017/03/03/ccia-1-hello-world/">CCIA-1-hello-world</a></li>
                    
                        <li><a href="/2017/03/03/algo-is-pop-order/">Is right Pop Sequence ?</a></li>
                    
                        <li><a href="/2017/03/02/tdd-steps/">How to apply tdd</a></li>
                    
                        <li><a href="/2017/03/02/algo-repalce-empty-space/">Replace Empty Space</a></li>
                    
                        <li><a href="/2017/03/01/find-number-in-array/">Find Integer</a></li>
                    
                        <li><a href="/2017/03/01/endian-formate/">Endian Formate</a></li>
                    
                </ul>
            </div>

            <!-- Content -->
            <div class="side ">
                <div>
                    <i class="fa fa-th-list"></i>
                    Categories
                </div>
                <ul class="content-ul" cate>
                    
                    <li>
                        <a href="/category/#tool" class="categories-list-item" cate="tool">
                            <span class="name">
                                tool
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#ipc" class="categories-list-item" cate="ipc">
                            <span class="name">
                                ipc
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#logging" class="categories-list-item" cate="logging">
                            <span class="name">
                                logging
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#game-server" class="categories-list-item" cate="game-server">
                            <span class="name">
                                game-server
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#algo" class="categories-list-item" cate="algo">
                            <span class="name">
                                algo
                            </span>
                            <span class="badge">5</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#network" class="categories-list-item" cate="network">
                            <span class="name">
                                network
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#test" class="categories-list-item" cate="test">
                            <span class="name">
                                test
                            </span>
                            <span class="badge">1</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="/category/#read" class="categories-list-item" cate="read">
                            <span class="name">
                                read
                            </span>
                            <span class="badge">4</span>
                        </a>
                    </li>
                    
                </ul>
            </div>
            <!-- 其他div框放到这里 -->
            <div class="side">
                <div>
                    <i class="fa fa-tags"></i>
                    Tags
                </div>
                <div class="tags-cloud">
                    
                    
                    
                    

                    

                    
                      
                      
                      
                      
                      
                      <a href="/tag/#swig" style="font-size: 18pt; color: #000;">swig</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#script-language" style="font-size: 18pt; color: #000;">script-language</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#c/c++" style="font-size: 18pt; color: #000;">c/c++</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#os" style="font-size: 12pt; color: #666;">os</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#lock-free" style="font-size: 9pt; color: #999;">lock-free</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#debug" style="font-size: 9pt; color: #999;">debug</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#gecoengine" style="font-size: 9pt; color: #999;">gecoengine</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#network" style="font-size: 9pt; color: #999;">network</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#list" style="font-size: 9pt; color: #999;">list</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#ordering" style="font-size: 9pt; color: #999;">ordering</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#endian" style="font-size: 9pt; color: #999;">endian</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#memory" style="font-size: 9pt; color: #999;">memory</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#array" style="font-size: 9pt; color: #999;">array</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#binary-search" style="font-size: 9pt; color: #999;">binary-search</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#stack" style="font-size: 12pt; color: #666;">stack</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#tdd" style="font-size: 9pt; color: #999;">tdd</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#thread" style="font-size: 15pt; color: #333;">thread</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#c++" style="font-size: 15pt; color: #333;">c++</a>
                    
                      
                      
                      
                      
                      
                      <a href="/tag/#iteration" style="font-size: 9pt; color: #999;">iteration</a>
                    
                </div>
            </div>

            <!-- <div class="side">
                <div>
                    <i class="fa fa-external-link"></i>
                    Links
                </div>
                <ul  class="content-ul">

                </ul>
            </div> -->
        </div>
    </div>
</div>
<!-- <script src="/js/scroll.min.js " charset="utf-8"></script> -->
<!-- <script src="/js/pageContent.js " charset="utf-8"></script> -->


    <footer class="site-footer">


    <div class="wrapper">

        <p class="description">
             For my youth dedicated to coding 
        </p>
        <p class="contact">
            Contact me at: 
            <a href="https://github.com/kiddinglife" title="GitHub"><i class="fa fa-github" aria-hidden="true"></i></a>  
            <a href="mailto:jakezhang1989@hotmail.com" title="email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a>       
            <a href="https://www.linkedin.com/in/kiddinglife" title="LinkedIn"><i class="fa fa-linkedin" aria-hidden="true"></i></a>  
        </p>
        <p>
            本站总访问量<span id="busuanzi_value_site_pv"></span>次，本站访客数<span id="busuanzi_value_site_uv"></span>人次，本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </p>
        <p class="power">
            <span>
                Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.
            </span>
            <span>
                Theme designed by <a href="https://github.com/Gaohaoyang">HyG</a>.
            </span>
        </p>
    </div>
</footer>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <div class="back-to-top">
    <a href="#top" data-scroll>
        <i class="fa fa-arrow-up" aria-hidden="true"></i>
    </a>
</div>

    <script src=" /js/main.js " charset="utf-8"></script>
    <script src=" /js/smooth-scroll.min.js " charset="utf-8"></script>
    <script type="text/javascript">
      smoothScroll.init({
        speed: 500, // Integer. How fast to complete the scroll in milliseconds
        easing: 'easeInOutCubic', // Easing pattern to use
        offset: 20, // Integer. How far to offset the scrolling anchor location in pixels
      });
    </script>
    <!-- <script src=" /js/scroll.min.js " charset="utf-8"></script> -->
  </body>

</html>
